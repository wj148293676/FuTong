<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>成缆仓储管理</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/swiper.min.css">
    <link rel="stylesheet" href="css/storage.css">
    <link rel="stylesheet" href="css/loading.css">
</head>
<body style="overflow: hidden">
<div id="wrap-content" style="overflow: hidden;">
    <div class="container tabDiv">
        <div class="row">
            <div class="col-xs-2 tab-item" style="margin-left: 10px;">
                <p class="tab-p text-center active">库存</p>
            </div>
            <div class="col-xs-2 tab-item">
                <p class="tab-p text-center">入库管理</p>
            </div>
            <div class="col-xs-2 tab-item">
                <p class="tab-p text-center">出库管理</p>
            </div>
        </div>
    </div>
    <div class="swiper-container" style="margin-top: 10px;">
        <div class="swiper-wrapper">
            <!--slide1-->
            <div class="swiper-slide">
                <div class="container queryDiv" style="padding: 0px;">
                    <div class="row" style="margin: 0px;">
                        <div class="col-xs-3 col-md-3">
                            <p class="input-title" style="display: inline;width:40%;">物料编号</p>
                            <input id="slide1_tubecode" class="query-input" type="text" style="width:60%;margin-left: 5px;display: inline">
                        </div>
                        <div class="col-xs-3 col-md-3">
                            <p class="input-title" style="display: inline;width:40%;">物料规格</p>
                            <input id="slide1_spec" class="query-input" type="text" style="width:60%;margin-left: 5px;display: inline">
                        </div>
                        <div class="col-xs-3 col-md-3">
                            <p class="input-title" style="display: inline;width:40%;">物料类别</p>
                            <div style="width:70%;margin-left: 5px;display: inline;">
                                <select id="mtype_select">
                                    <option value="0">全部</option>
                                    <option value="1">缆芯</option>
                                    <option value="2">内护套</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-xs-3 col-md-3">
                            <button id="query-btn" class="center-block" style="width: 50%;">查询</button>
                        </div>
                    </div>
                </div>
                <div class="panel-body" style="padding: 10px;">
                    <table id="header_table" class="table table-bordered" style="table-layout:fixed;display: none;">
                        <thead>
                        <tr>
                            <th style="width: 50px;"></th>
                            <th>物料编号</th>
                            <th style="width: 80px;">物料类别</th>
                            <th style="width: 260px;">物料规格</th>
                            <th style="width: 80px;">长度(m)</th>
                            <th style="width: 70px;">品质</th>
                            <th>盘具编号</th>
                            <th>库位编号</th>
                            <th>入库时间</th>
                            <th>来源</th>
                            <th style="width: 85px;">备注</th>
                        </tr>
                        </thead>
                    </table>
                    <div id="query-tableDiv" style="overflow-y: auto;margin-top: -20px">
                        <table class="table table-bordered" style="table-layout:fixed;">
                            <tbody id="formBody">
                            <script type="text/template" charset="UTF-8" id="template">
                                {{if(it && it.length>0){}}
                                {{for(var i=0; i < it.length; i++){}}
                                <tr class="task" id="task_daijian{{=(i+1)}}">
                                    <th class="index-th" scope="row" style="width: 50px;">{{=(i+1)}}</th>
                                    <td class="antoLine" style="font-size: 14px;font-weight: normal">{{=it[i].物料编号}}</td>
                                    <td class="antoLine" style="font-size: 14px;font-weight: normal;width: 80px;">{{=it[i].物类别称}}</td>
                                    <td class="antoLine" style="font-size: 14px;font-weight: normal;width: 260px;">{{=it[i].物料规格}}</td>
                                    <td class="antoLine" style="font-size: 14px;font-weight: normal;width: 80px;">{{=it[i].长度}}</td>
                                    <td class="antoLine" style="font-size: 14px;font-weight: normal;width: 70px;">{{=it[i].品质}}</td>
                                    <td class="antoLine" style="font-size: 14px;font-weight: normal;">{{=it[i].盘具编号}}</td>
                                    <td class="antoLine" style="font-size: 14px;font-weight: normal;">{{=it[i].库位编号}}</td>
                                    <td class="antoLine" style="font-size: 14px;font-weight: normal">{{=it[i].入库时间}}</td>
                                    <td class="antoLine" style="font-size: 14px;font-weight: normal;">{{=it[i].来源}}</td>
                                    <td class="antoLine" style="font-size: 14px;font-weight: normal;width: 85px;">{{=it[i].备注}}</td>
                                </tr>
                                {{}}}
                                {{}}}
                            </script>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!--slide2-->
            <div class="swiper-slide">
                <div class="container">
                    <div class="row itemDiv2">
                        <div class="col-xs-2">
                            <p class="input-title2 text-left">盘具编号：</p>
                        </div>
                        <div class="col-xs-4" style="padding: 0;">
                            <input id="slide2_Tube3" class="query-input2" type="text">
                        </div>
                        <div class="col-xs-2">
                            <p class="input-title2 text-left">物料编号：</p>
                        </div>
                        <div class="col-xs-4" style="padding: 0;">
                            <input id="slide2_TubePlateCode" class="query-input2" type="text" disabled="disabled">
                        </div>
                    </div>
                    <div class="row itemDiv2">
                        <div class="col-xs-2">
                            <p class="input-title2 text-left">长度(m)：</p>
                        </div>
                        <div class="col-xs-4" style="padding: 0;">
                            <input id="slide2_TubeLength" class="query-input2" type="text" disabled="disabled">
                        </div>
                        <div class="col-xs-2">
                            <p class="input-title2 text-left">物料规格：</p>
                        </div>
                        <div class="col-xs-4" style="padding: 0;">
                            <input id="slide2_Tube2" class="query-input2" type="text" disabled="disabled">
                        </div>
                    </div>
                    <div class="row itemDiv2">
                        <div class="col-xs-2">
                            <p class="input-title2 text-left">品质：</p>
                        </div>
                        <div class="col-xs-4" style="padding: 0;">
                            <input id="slide2_Tube4" class="query-input2" type="text" disabled="disabled">
                        </div>
                        <div class="col-xs-2">
                            <p class="input-title2 text-left">库位编号：</p>
                        </div>
                        <div class="col-xs-2" style="padding: 0;">
                            <input id="ShelfNo_input" class="query-input2" type="text">
                        </div>
                        <div class="col-xs-2">
                            <button id="query-btn2">选择</button>
                        </div>
                    </div>
                    <div class="row" style="display: none;">
                        <p id="mtype"></p>
                    </div>
                    <div class="row itemDiv2" style="margin-top: 60px;">
                        <div class="col-xs-4 col-md-4 text-right">
                            <button id="sure-btn2">确定</button>
                        </div>
                        <div class="col-xs-4 col-md-4"></div>
                        <div class="col-xs-4 col-md-4 text-left">
                            <button id="cancel-btn2">清空</button>
                        </div>
                    </div>
                </div>
            </div>
            <!--slide3-->
            <div class="swiper-slide">
                <div class="container">
                    <div class="row itemDiv2" style="margin-top: 100px;">
                        <div class="col-xs-3">
                            <p class="input-title2 text-right">盘具编号：</p>
                        </div>
                        <div class="col-xs-6">
                            <input id="slide3_TubePlateCode_input" class="query-input2" type="text" style="margin-left: 0px;">
                        </div>
                    </div>
                    <div class="row itemDiv2" style="margin-top: 60px;">
                        <div class="col-xs-4 col-md-4 text-right">
                            <button id="sure-btn3">确定</button>
                        </div>
                        <div class="col-xs-4 col-md-4"></div>
                        <div class="col-xs-4 col-md-4 text-left">
                            <button id="cancel-btn3">清空</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--loading-->
<div id="loading" class="spinner">
    <div class="bounce1"></div>
    <div class="bounce2"></div>
    <div class="bounce3"></div>
</div>

<script type="text/javascript" src="js/doT.js"></script>
<script type='text/javascript' src='js/jquery-2.0.3.min.js' charset='utf-8'></script>
<script type='text/javascript' src='js/bootstrap.min.js' charset='utf-8'></script>
<script type="text/javascript" src="js/swiper.min.js"></script>
<script type="text/javascript" src="js/ftcommon.js"></script>
<script type="text/javascript">
    var template;
    var my_macno;
    var myusername;
    var Timer;
    var publicNum;
    $(function(){
        android.windowReady();
        $('#wrap-content').css('height',$(window).height()+'px');
        template = document.getElementById('template').innerHTML;
        initSwiper();//初始化swiper
        $('#query-tableDiv').css('height',$(window).height()-$('.tabDiv').eq(0).height()-$('.queryDiv').eq(0).height());
        $('#query-tableDiv').css('padding-bottom',$('.queryDiv').eq(0).height()+15);
    });

    //设置用户名
    function setusername(username,server_Domain) {
        xgxx.server_Domain=server_Domain;
        myusername=username;
    }

    //初始化swiper
    function initSwiper() {
        $('.swiper-container').height($(window).height());
        var mySwiper = new Swiper ('.swiper-container', {
            direction: 'horizontal',
            loop: false,
            onSlideChangeEnd: function(swiper){
                $('.tab-p').removeClass('active');
                $('.tab-p').eq(swiper.activeIndex).addClass('active');
            }
        });
        $('.tab-p').click(function () {
            mySwiper.slideTo($('.tab-p').index(this), 500, false);
            $('.tab-p').removeClass('active');
            $('.tab-p').eq(mySwiper.activeIndex).addClass('active');
        });
    }
    //slide1  查询点击事件
    $('#query-btn').click(function () {
        queryStorage();
    });
    //物料编号回车事件
    $('#slide1_tubecode').keyup(function(event){
        if(event.keyCode ==13){
            queryStorage();
        }
    });
    //物料规格回车事件
    $('#slide1_spec').keyup(function(event){
        if(event.keyCode ==13){
            queryStorage();
        }
    });
    
    //查询库存
    function queryStorage() {
        showLoading();
        var tubecode=$('#slide1_tubecode').val().toUpperCase();
        $('#slide1_tubecode').val(tubecode);
        var spec=$('#slide1_spec').val();
        var mtype=$('#mtype_select').val();
        console.log(tubecode);
        console.log(spec);
        console.log(mtype);
        android.startLoading();
        xgxx.ajax('WmsLx/GetList?callback=callback',{
            data:{
                lxcode:tubecode,
                spec:spec,
                mtype:mtype
            },
            success: function (result, status) {
                android.endLoading();
                jsonData="";
                document.getElementById('formBody').innerHTML = doT.template(template)(jsonData);
                closeLoading();
                var jsonData = eval(result);
                console.log(JSON.stringify(jsonData));
                for(var j=0; j<jsonData.length; j++){
                    var obj = jsonData[j];
                    for(var i in obj) {
                        if(Object.prototype.hasOwnProperty.call(obj,i)) { //过滤
                            if(obj[i]==null){
                                obj[i]="";
                            }
                        }
                    }
                }
                for(var i=0; i<jsonData.length; i++){
                    var tempStr=jsonData[i].入库时间.replace('T', ' ');
                    var newTime=tempStr.substring(0,16);
                    if(newTime.substring(0,4)=='1900'){
                        newTime = ""
                    }
                    jsonData[i].入库时间=newTime;
                }
                document.getElementById('formBody').innerHTML = doT.template(template)(jsonData);
                $('#header_table').show();
                $('#tableDiv').show();
            },
            error: function (error) {
                android.endLoading();
                closeLoading();
                alert("错误"+JSON.stringify(error));
            }
        });
    }

    //slide2  盘具编号失去光标事件
    $("#slide2_Tube3").keyup(function(){
        if(event.keyCode == 13){
            var panno=$('#slide2_Tube3').val().toUpperCase();
            $('#slide2_Tube3').val(panno);
            android.startLoading();
            xgxx.ajax('WmsLx/Getlx?callback=callback',{
                data:{
                    panno:panno
                },
                success: function (result, status) {
                    android.endLoading();
                    if(result=="无数据"){
                        android.showToast(result);
                        $("#slide2_Tube3").focus();
                        $("#slide2_Tube3").select();
                        return;
                    }
                    var jsonData = eval(result);
                    console.log(JSON.stringify(jsonData));
                    $('#slide2_TubePlateCode').val(jsonData[0].物料编号);
                    $('#slide2_TubeLength').val(jsonData[0].长度);
                    $('#slide2_Tube2').val(jsonData[0].物料规格);
                    $('#slide2_Tube4').val(jsonData[0].品质);
                    $('#mtype').val(jsonData[0].类别);
                    if($('#ShelfNo_input').val()==""){
                        $('#ShelfNo_input').focus();
                    }else{
                        $('#ShelfNo_input').focus();
                        $('#ShelfNo_input').select();
                    }
                },
                error: function (error) {
                    android.endLoading();
                    closeLoading();
                    alert("错误"+JSON.stringify(error));
                }
            });
        }
    });
    //slide2  点击选择按钮进入库区选择页面
    $('#query-btn2').click(function () {
        var panno=$('#slide2_Tube3').val();
        var category=$('#mtype').val();
        var quality=$('#slide2_Tube4').val();
        if(panno==null || panno=="" || panno.length==0){
            android.showToast("盘具编号不能为空");
            return;
        }
        android.chooseStorage(quality,category);
    });
    function setShelfNo(ShelfNo) {
        $('#ShelfNo_input').val(ShelfNo);
    }
    //slide2 确定按钮入库
    $('#sure-btn2').click(function () {
        inStorage();
    });
    //盘具编号输入框回车事件
    $('#ShelfNo_input').keyup(function(event){
        if(event.keyCode ==13){
            inStorage();
        }
    });
    //入库
    function inStorage() {
        var mtype=$('#mtype').val();//类别
        var SFGCode=$('#slide2_TubePlateCode').val();//物料编号
        var ShelfNo=$('#ShelfNo_input').val();//库位编码
        var Quality=$('#slide2_Tube4').val();//品质
        var SFGPan=$('#slide2_Tube3').val();//盘具编号

        if(SFGCode==null || SFGCode=="" || SFGCode.length==0){
            android.showToast("物料编号不能为空");
            return;
        }
        if(ShelfNo==null || ShelfNo=="" || ShelfNo.length==0){
            android.showToast("库位编号不能为空");
            return;
        }
        if(Quality==null || Quality=="" || Quality.length==0){
            android.showToast("品质不能为空");
            return;
        }
        if(SFGPan==null || SFGPan=="" || SFGPan.length==0){
            android.showToast("盘具编号不能为空");
            return;
        }
        var jsonObj={};
        jsonObj['SFGCode']=SFGCode;
        jsonObj['ShelfNo']=ShelfNo;
        jsonObj['Quality']=Quality;
        jsonObj['SFGPan']=SFGPan;
        jsonObj['ShelfGUID']='';
        android.print(JSON.stringify(jsonObj));
        android.print(mtype);
        android.startLoading();
        xgxx.ajax('WmsLx/StorageIn?callback=callback',{
            data:{
                mainJson:JSON.stringify(jsonObj),
                usercode:myusername,
                username:myusername,
                mtype:mtype
            },
            success: function (result, status) {
                android.endLoading();
                if(result=="入库成功" || result=="更新库位成功"){
                    android.showToast(result);
                    $('#slide2_Tube3').val("");
                    $('#slide2_TubePlateCode').val("");
                    $('#slide2_TubeLength').val("");
                    $('#slide2_Tube2').val("");
                    $('#slide2_Tube4').val("");
                    $('#ShelfNo_input').val("");
                    $('#slide2_Tube3').focus();
                }else{
                    android.showToast(result);
                    $('#slide2_Tube3').focus();
                    $('#slide2_Tube3').select();
                }
            },
            error: function (error) {
                android.endLoading();
                closeLoading();
                alert("错误"+JSON.stringify(error));
            }
        });
    }

    //slide3 确定出库按钮
    $('#sure-btn3').click(function () {
        outStorage();
    });
    //盘具编号输入框回车事件
    $('#slide3_TubePlateCode_input').keyup(function(event){
        if(event.keyCode ==13){
            outStorage();
        }
    });
    //出库
    function outStorage() {
        var slide3_TubePlateCode=$('#slide3_TubePlateCode_input').val().toUpperCase();//盘具编号
        $('#slide3_TubePlateCode_input').val(slide3_TubePlateCode);
        if(slide3_TubePlateCode==null || slide3_TubePlateCode=="" || slide3_TubePlateCode.length==0){
            android.showToast("盘具编号不能为空");
            return;
        }
        android.startLoading();
        xgxx.ajax('WmsLx/StorageOut?callback=callback',{
            data:{
                panno:slide3_TubePlateCode
            },
            success: function (result, status) {
                android.endLoading();
                if(result=="出库成功"){
                    android.showToast(result);
                    $('#slide3_TubePlateCode_input').val("");
                    $('#slide3_TubePlateCode_input').focus();
                }else{
                    android.showToast("出库失败，请重新出库");
                    $('#slide3_TubePlateCode_input').focus();
                    $('#slide3_TubePlateCode_input').select();
                }
            },
            error: function (error) {
                android.endLoading();
                closeLoading();
                alert("错误"+JSON.stringify(error));
            }
        });
    }


    $('#cancel-btn2').click(function () {
        $('#slide2_Tube3').val("");
        $('#slide2_TubePlateCode').val("");
        $('#slide2_TubeLength').val("");
        $('#slide2_Tube2').val("");
        $('#slide2_Tube4').val("");
        $('#ShelfNo_input').val("");
    });
    $('#cancel-btn3').click(function () {
        $('#slide3_TubePlateCode_input').val("");
    });
</script>
</body>
</html>
