<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>着色返修处理-复绕</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/swiper.min.css">
    <link rel="stylesheet" href="css/storage.css">
    <link rel="stylesheet" href="css/loading.css">
    <link rel="stylesheet" href="css/mui.min.css">
    <link rel="stylesheet" href="css/mui.picker.min.css">
    <link rel="stylesheet" href="css/mui.poppicker.css">
    <style type="text/css">
        .btn,.title{
            font-family: "微软雅黑";
            font-size: 16px;
        }
        .title{
            font-size: 22px;
            font-weight: 800;
            line-height: 35px;
        }
        .devideLine{
            width: 98%;
            height: 2px;
            background: #666666;
            margin-top: 15px;
        }
        .textarea{
            width: 100%;
            min-height: 60px;
            margin-top: 20px;
            margin-left: auto;
            margin-right: auto;
            padding: 15px;
            outline: 0;
            border: 1px solid #999999;
            font-size: 16px;
            line-height: 24px;
            word-wrap: break-word;
            overflow-x: hidden;
            overflow-y: auto;
        }
        .box-container{
            margin-top: 30px;
            padding-bottom: 30px;
            border: 1px solid #999999;
            position: relative;
        }
        .title-p{
            position: absolute;
            font-family: "微软雅黑";
            font-size: 18px;
            font-weight: bold;
            top: -15px;
            left: 30px;
            z-index: 100;
            padding-left: 10px;
            padding-right: 10px;
            background: #ffffff;
        }
        .input-xgit{
            border: 1px solid #cccccc;
            outline: none;
            height: 35px;
            line-height: 30px;
            padding: 3px 5px;
        }
        .inner-title{
            font-family: "微软雅黑";
            font-size: 16px;
            line-height: 35px;
        }
        .workBtnDiv button{
            margin-top: 10px;
        }
        .remark_p{
            font-family: "微软雅黑";
            font-size: 16px;
            margin-top: 40px;
        }
        .input-group span{
            font-family: "微软雅黑";
        }
        .modal-header{
            background: #3A89ED;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }
        .modal-title{
            font-family: 微软雅黑;color: white;
        }
        .textinfo{
            font-size: 20px;font-family: 微软雅黑;line-height: 150px;
        }
        .selectDiv{
            border: 1px solid #cccccc;height: 40px;border-radius: 5px;
        }
        .selectDiv p{
            height:39px;line-height: 39px;background: #eeeeee;font-size: 16px;font-family: 微软雅黑;color: #666666;border-bottom: 1px solid #cccccc;
        }
    </style>
</head>
<body>
<div id="wrap-content" style="overflow:hidden;">
    <div class="container" style="margin-top: 10px;padding: 0px;">
        <div class="row tabDiv">
            <div class="col-xs-2 tab-item">
                <p class="tab-p text-center active">查看</p>
            </div>
            <div class="col-xs-2 tab-item">
                <p class="tab-p text-center">参数录入</p>
            </div>
            <div class="col-xs-2 col-md-2"></div>
            <div class="col-xs-2 col-md-2 workBtnDiv">
                <button id="saveBtn" type="button" class="btn btn-primary center-block" style="width: 90%;">保存</button>
            </div>
            <div class="col-xs-2 col-md-2 workBtnDiv">
                <button id="finishBtn" type="button"  class="btn btn-primary center-block" style="width: 90%;">复绕完成</button>
            </div>
            <div class="col-xs-2 col-md-2 workBtnDiv">
                <button id="clearBtn" type="button" class="btn btn-primary center-block" style="width: 90%;">清除复绕信息</button>
            </div>
        </div>
    </div>
    <div class="swiper-container" style="margin-top: 10px;">
        <div class="swiper-wrapper">
            <!--slide1-->
            <div class="swiper-slide" style="overflow-y: auto;">
                <div class="container" style="padding: 0px;margin-bottom: 120px;">
                    <div class="box-container">
                        <p class="text-center title-p">基础信息</p>
                        <div class="row" style="margin-top: 20px;padding: 15px;">
                            <div class="col-xs-3 col-md-3">
                                <div class="input-group">
                                    <span class="input-group-addon">着色纤编号</span>
                                    <input id="line_code" type="text" class="form-control" aria-describedby="jitai_code" readonly="readonly">
                                    <p id="GUID" style="display: none;"></p>
                                </div>
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <div class="input-group">
                                    <span class="input-group-addon">规格</span>
                                    <input id="lineSpec" type="text" class="form-control" aria-describedby="fr_length" readonly="readonly">
                                </div>
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <div class="input-group">
                                    <span class="input-group-addon">色标</span>
                                    <input id="sebiao" type="text" class="form-control" aria-describedby="basic-addon1" readonly="readonly">
                                </div>
                            </div>
                            <div class="col-xs-3 col-md-3">
                                <div class="input-group">
                                    <span class="input-group-addon">OTDR测试长(m)</span>
                                    <input id="lineLen" type="text" class="form-control" aria-describedby="basic-addon1" readonly="readonly">
                                </div>
                            </div>
                        </div>
                        <div class="row" style="padding: 15px;">
                            <p class="col-xs-2 col-md-2 remark_p">原材料使用:</p>
                            <div class="col-xs-10 col-md-10">
                                <div id="MaterialsInfo1" class="textarea" contenteditable="false"><br /></div>
                            </div>
                        </div>
                    </div>
                    <div class="box-container">
                        <p class="text-center title-p">不合格信息</p>
                        <div class="row" style="margin-top: 20px;padding: 15px;">
                            <table id="header_table" class="table table-bordered" style="table-layout:fixed;">
                                <thead>
                                    <tr>
                                        <th class="antoLine">不合格内容</th>
                                        <th class="antoLine">事件起点</th>
                                        <th class="antoLine">事件参照点</th>
                                        <th class="antoLine">废纤长度m</th>
                                        <th class="antoLine">1310(db)</th>
                                        <th class="antoLine">1550(db)</th>
                                        <th class="antoLine">备注</th>
                                    </tr>
                                </thead>
                                <tbody id="formBody">
                                    <script type="text/template" charset="UTF-8" id="template">
                                        {{if(it && it.length>0){}}
                                            {{for(var i=0; i < it.length; i++){}}
                                                <tr>
                                                    <td class="antoLine">{{=it[i].不合格内容}}</td>
                                                    <td class="antoLine">{{=it[i].事件起始点}}</td>
                                                    <td class="antoLine">{{=it[i].事件参照点}}</td>
                                                    <td class="antoLine">{{=it[i].废纤长度}}</td>
                                                    <td class="antoLine">{{=it[i].衰减1310}}</td>
                                                    <td class="antoLine">{{=it[i].衰减1550}}</td>
                                                    <td class="antoLine">{{=it[i].备注}}</td>
                                                </tr>
                                            {{}}}
                                        {{}}}
                                    </script>
                                </tbody>
                            </table>
                        </div>
                        <div class="row" style="padding: 15px;">
                            <p class="col-xs-2 col-md-2 remark_p">不合格内容备注:</p>
                            <div class="col-xs-10 col-md-10">
                                <div id="contentRemark" class="textarea" contenteditable="false"><br /></div>
                            </div>
                        </div>
                        <div class="row" style="padding: 15px;">
                            <p class="col-xs-2 col-md-2 remark_p">工艺师处理意见备注:</p>
                            <div class="col-xs-10 col-md-10">
                                <div id="ProRemark" class="textarea" contenteditable="false"><br /></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--slide2-->
            <div class="swiper-slide" style="overflow-y: auto;">
                <div class="container" style="padding: 0px;margin-bottom: 120px;">
                    <div class="row" style="margin-top: 50px;">
                        <div class="col-xs-5 col-md-5">
                            <div class="input-group">
                                <span class="input-group-addon">复绕机台</span>
                                <input id="jitai_code" type="text" class="form-control" aria-describedby="jitai_code" readonly="readonly" style="background: #ffffff;">
                            </div>
                        </div>
                        <div class="col-xs-4 col-md-4">
                            <div class="input-group">
                                <span class="input-group-addon">复绕长度(m)</span>
                                <input id="OrdrLen" type="text" class="form-control" aria-describedby="fr_length">
                            </div>
                        </div>
                        <div class="col-xs-3 col-md-3">
                            <div class="input-group">
                                <span class="input-group-addon">作业人员</span>
                                <input id="operatorname" type="text" class="form-control" aria-describedby="basic-addon1" disabled="disabled">
                            </div>
                        </div>
                    </div>
                    <div class="row" style="margin-top: 50px;">
                        <div class="col-xs-4 col-md-4">
                            <div class="input-group">
                                <span class="input-group-addon">作业时间</span>
                                <input id="operatortime" type="text" class="form-control" aria-describedby="jitai_code" disabled="disabled">
                            </div>
                        </div>
                        <div class="col-xs-4 col-md-4">
                            <div class="input-group">
                                <span class="input-group-addon">状态</span>
                                <input id="StateView" type="text" class="form-control" aria-describedby="fr_length" disabled="disabled">
                            </div>
                        </div>
                    </div>
                    <div class="box-container" style="margin-top: 60px;">
                        <p class="text-center title-p">复绕参数录入</p>
                        <div class="row" style="margin-top: 20px;padding: 15px;">
                            <div class="col-xs-4 col-md-4">
                                <div class="input-group">
                                    <span class="input-group-addon">复绕线速(m/min)</span>
                                    <input id="fr_speed" type="text" class="form-control" aria-describedby="jitai_code">
                                </div>
                            </div>
                            <div class="col-xs-4 col-md-4">
                                <div class="input-group">
                                    <span class="input-group-addon">收线张力(bar)</span>
                                    <input id="shou_zhangli" type="text" class="form-control" aria-describedby="fr_length">
                                </div>
                            </div>
                            <div class="col-xs-4 col-md-4">
                                <div class="input-group">
                                    <span class="input-group-addon">放线张力(bar)</span>
                                    <input id="fang_zhangli" type="text" class="form-control" aria-describedby="basic-addon1">
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin-top: 20px;padding: 15px;">
                            <div class="col-xs-4 col-md-4">
                                <div class="input-group">
                                    <span class="input-group-addon">收线盘直径(mm)</span>
                                    <input id="shoupanZJ" type="text" class="form-control" aria-describedby="jitai_code">
                                </div>
                            </div>
                            <div class="col-xs-4 col-md-4">
                                <div class="input-group">
                                    <span class="input-group-addon">收排线节距(um)</span>
                                    <input id="shoupaiJJ" type="text" class="form-control" aria-describedby="fr_length">
                                </div>
                            </div>
                            <div class="col-xs-4 col-md-4">
                                <div class="input-group">
                                    <span class="input-group-addon">固化炉温度</span>
                                    <input id="luWen" type="text" class="form-control" aria-describedby="basic-addon1">
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin-top: 20px;padding: 15px;">
                            <div class="col-xs-3 col-md-3">
                                <div class="selectDiv">
                                    <div class="row">
                                        <div class="col-xs-6 col-md-6">
                                            <p class="text-center">收排线状况</p>
                                        </div>
                                        <div class="col-xs-6 col-md-6">
                                            <select id="sp_line_state" name="" style="height: 35px;">
                                                <option value="0"></option>
                                                <option value="1">良</option>
                                                <option value="2">不良</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-6 col-md-6">
                                <div class="input-group">
                                    <span class="input-group-addon">目标仓库</span>
                                    <input id="storage" type="text" class="form-control" aria-describedby="jitai_code" disabled="disabled">
                                </div>
                            </div>
                        </div>
                        <div class="row" style="padding: 15px;">
                            <p class="col-xs-2 col-md-2 remark_p">备注:</p>
                            <div class="col-xs-10 col-md-10">
                                <div id="slide2_remark" class="textarea" contenteditable="true"><br /></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--loading-->
<div id="loading" class="spinner">
    <div class="bounce1"></div>
    <div class="bounce2"></div>
    <div class="bounce3"></div>
</div>

<!--bootstrap模态框-->
<div id="myModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="gridSystemModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title center-block text-center" id="gridSystemModalLabel">提示</h4>
            </div>
            <div class="modal-body"style="height: 150px">
                <div class="row">
                    <div class="col-md-2 col-xs-2"></div>
                    <div class="col-md-8 col-xs-8 center-block text-center textinfo">确定复绕完成吗？</div>
                    <div class="col-md-2 col-xs-2"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button id="sureFinishBtn" type="button" class="btn btn-primary">确认</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<script type='text/javascript' src='js/jquery-2.0.3.min.js' charset='utf-8'></script>
<script type='text/javascript' src='js/bootstrap.min.js' charset='utf-8'></script>
<script type="text/javascript" src="js/swiper.min.js"></script>
<script type="text/javascript" src="js/ftcommon.js"></script>
<script type="text/javascript" src="js/mui.min.js"></script>
<script type="text/javascript" src="js/mui.picker.min.js"></script>
<script type="text/javascript" src="js/mui.poppicker.js"></script>
<script type="text/javascript" src="js/doT.js"></script>
<script type="text/javascript">

    //收排线状况是下拉选择的，着色的良-1，不良-0；其他的都是良-0，不良-1
    var template;
    var my_macno;
    var myusername;
    var myusercode;
    var Timer;
    var publicNum;
    var Quality;
    var GUID;
    $(function(){
        android.startLoading();
        android.windowReady();
//        setusername("admin","http://10.100.2.11:8095/","b2773b00-1b38-4ea4-93a4-24be47d7ddbd");
        $('#wrap-content').css('height',$(window).height()+'px');
        initSwiper();//初始化swiper
    });

    //初始化swiper
    function initSwiper() {
        $('.workBtnDiv').css('display','none');
        $('.swiper-container').height($(window).height());
        var mySwiper = new Swiper ('.swiper-container', {
            direction: 'horizontal',
            loop: false,
            onSlideChangeEnd: function(swiper){
                $('.tab-p').removeClass('active');
                $('.tab-p').eq(swiper.activeIndex).addClass('active');
                if(swiper.activeIndex==0){
                    $('.workBtnDiv').css('display','none');
                }else{
                    $('.workBtnDiv').css('display','block');
                }
            }
        });
        $('.tab-p').click(function () {
            if($('.tab-p').index(this)==0){
                $('.workBtnDiv').css('display','none');
            }else{
                $('.workBtnDiv').css('display','block');
            }
            mySwiper.slideTo($('.tab-p').index(this), 500, false);
            $('.tab-p').removeClass('active');
            $('.tab-p').eq(mySwiper.activeIndex).addClass('active');

        });
    }

    //设置用户名
    function setusername(username,server_Domain,GUID) {
        xgxx.server_Domain=server_Domain;
        myusername=username;
        myusercode="";
        GUID=GUID;
        getInfo(GUID);//获取基础信息
        $('#GUID').html(GUID);
        saveInfo();
        finishFr();
        clearInfo();
        $('#sureFinishBtn').click(function () {
            sureFinishBtn();
        });
    }

    function getInfo(GUID) {
        xgxx.ajax('ZSFiberrepair/GetZSFiberRepairInput?callback=callback',{
            data:{
                guid:GUID,
                promethod:"1"
            },
            success: function (result, status) {
                if(result.Msg=="ok"){
                    $('#line_code').val(result.BasicInfo[0].ZsfCode);//缆芯编号
                    $('#lineSpec').val(result.BasicInfo[0].ZsfSpec);//缆芯规格
                    $('#sebiao').val(result.BasicInfo[0].ZsfColorName);//色标
                    $('#lineLen').val(result.BasicInfo[0].OTDRlen);//OTDR测试长
                    $('#MaterialsInfo1').html(result.BasicInfo[0].MaterialsInfo1);//原材料使用
                    $('#contentRemark').html(result.BasicInfo[0].contentRemark);//不合格内容备注
                    $('#ProRemark').html(result.BasicInfo[0].ProRemark);//工艺师意见

                    if(result.InputInfo[0].ProState=='复绕中'){
                        $('#jitai_code').val(result.InputInfo[0].MacCode);//复绕机台
                        $('#jitai_code').data("Code",result.InputInfo[0].MacCode);
                        $('#OrdrLen').val(result.InputInfo[0].ZSFLen);//复绕长度
                        $('#StateView').val(result.InputInfo[0].ProState);//状态
                        $('#fr_speed').val(result.InputInfo[0].Speed);//复绕线速
                        $('#shou_zhangli').val(result.InputInfo[0].SXZhangLi);//收线张力
                        $('#fang_zhangli').val(result.InputInfo[0].FXZhangLi);//放线张力
                        $('#sp_line_state').val(result.InputInfo[0].spxzhuangkuang);//收线盘状况
                        $('#shoupanZJ').val(result.InputInfo[0].spxzhijing);//收线盘直径
                        $('#shoupaiJJ').val(result.InputInfo[0].spxjieju);//收线盘节距
                        $('#luWen').val(result.InputInfo[0].zslwendu);//固化炉温度
                        $('#storage').val(result.InputInfo[0].StorageName);//目标仓库
                        $('#storage').data("TargetStorage",result.InputInfo[0].TargetStorage);//目标仓库
                        if(result.InputInfo[0].OperatorName=="" || result.InputInfo[0].OperatorName==undefined){
                            $('#operatorname').val(myusername);//作业人员
                        }else{
                            $('#operatorname').val(result.InputInfo[0].OperatorName);//作业人员
                        }
                        if(result.InputInfo[0].OperatorTime=="" || result.InputInfo[0].OperatorTime==undefined){
                            $('#operatortime').val(Format(new Date(),"yyyy-MM-dd HH:mm"));//作业时间
                        }else{
                            $('#operatortime').val(result.InputInfo[0].OperatorTime.replace('T', ' '));//作业时间
                        }
                    }else if(result.InputInfo[0].状态=='未开始'){
                        $('#StateView').val(result.InputInfo[0].状态);//状态
                        $('#OrdrLen').val(result.InputInfo[0].ordlen);//复绕长度
                        $('#luWen').val(result.InputInfo[0].ZSLWenDu );//固化炉温度
                        $('#shou_zhangli').val(result.InputInfo[0].SXZhangLi);//收线张力
                        $('#fang_zhangli').val(result.InputInfo[0].FXZhangLi);//放线张力
                        $('#sp_line_state').val(result.InputInfo[0].SPXZhuangKuang);//收线盘状况
                        $('#shoupanZJ').val(result.InputInfo[0].SPXZhiJing);//收线盘直径
                        $('#shoupaiJJ').val(result.InputInfo[0].SPXJieJu);//收线盘节距
                        $('#storage').val(result.InputInfo[0].StorageName);//目标仓库
                        $('#storage').data("TargetStorage",result.InputInfo[0].TargetStorage);//目标仓库
                        $('#operatorname').val(myusername);//作业人员
                        $('#operatortime').val(Format(new Date(),"yyyy-MM-dd HH:mm"));//作业时间
                    }
                    var tablejsonData=NullToBlank(result.UqInfo);
                    template = document.getElementById('template').innerHTML;
                    document.getElementById('formBody').innerHTML = doT.template(template)(tablejsonData);
                    var jsonData=[];
                    var datas = {};
                    datas['value'] = result.ProList[0].Code;
                    datas['text'] = result.ProList[0].ProcessName;
                    var objarray=[];
                    for(var j=0;j<result.EquList.length;j++){
                        if(result.EquList[j].ProcessName==result.ProList[0].ProcessName){
                            var item = {};
                            item['value'] = result.EquList[j].Code;
                            item['text'] = result.EquList[j].MacName+"(位置："+result.EquList[j].Position+")";
                            objarray.push(item);
                        }
                    }
                    datas['children'] = objarray;
                    jsonData.push(datas);
//                    for(var i=0;i<result.ProList.length;i++){
//                        var datas = {};
//                        datas['value'] = result.ProList[i].Code;
//                        datas['text'] = result.ProList[i].ProcessName;
//                        var objarray=[];
//                        for(var j=0;j<result.EquList.length;j++){
//                            if(result.EquList[j].ProcessName==result.ProList[i].ProcessName){
//                                var item = {};
//                                item['value'] = result.EquList[j].Code;
//                                item['text'] = result.EquList[j].MacName+"(位置："+result.EquList[j].Position+")";
//                                objarray.push(item);
//                            }
//                        }
//                        datas['children'] = objarray;
//                        jsonData.push(datas);
//                    }
                    initPicker(jsonData);
                }
            },
            error: function (error) {
                android.endLoading();
                closeLoading();
                alert("错误"+JSON.stringify(error));
            }
        });
    }

    //保存
    function saveInfo() {
        $('#saveBtn').click(function () {
            var savejson=[];
            var obj={};
            var guid=$('#GUID').html();
            obj['GUID']=$('#GUID').html();
            obj['ZsfCode']=$('#line_code').val();//成缆编号
            obj['AdirectB']=-1;
            obj['MacCode']=$('#jitai_code').data("Code");//机台代码
            obj['Speed']=$('#fr_speed').val();//复绕线速

            obj['SXZhangLi']=$('#shou_zhangli').val();//收线张力
            obj['FXZhangLi']=$('#fang_zhangli').val();//放线张力
            obj['SPXJieJu']=$('#shoupaiJJ').val();//收排线状况
            obj['SPXZhiJing']=$('#shoupanZJ').val();//收线张力
            obj['SPXZhuangKuang']=$('#sp_line_state').val();//放线张力
            obj['TargetStorage']=$('#storage').data("TargetStorage");//目标仓库;
            obj['ZsfLen']=$('#OrdrLen').val();//复绕长度
            obj['PrintCount']="";//打印次数 默认为””
            obj['Operator']="";//操作者编码
            obj['OperatorName']=myusername;//操作者姓名
            obj['OperatorTime']=$('#operatortime').val();//操作时间
            obj['Remark']=$('#slide2_remark').html();//备注
            obj['ZSLWenDu']=$('#luWen').val();//炉温
            savejson.push(obj);
            savejson = JSON.stringify(savejson);
            android.print(typeof(savejson));
            android.print(guid);
            android.print(savejson);

            var  datas=new Object();
            datas.callback='callback';
            datas.flag='1';
            datas.guid=$('#GUID').html();
            datas.savejson=savejson;
            android.print(JSON.stringify(datas));

            android.startLoading();
            $.ajax({
                url: xgxx.server_Domain+"ZSFiberrepair/SaveZSFiberRepair",
                type: 'post',
                data: datas,
                crossDomain: true,
                timeout: 50000,
                success:function(data){
                    android.endLoading();
                    android.showToast(JSON.stringify(data));
                    android.print(JSON.stringify(data));
                },
                error:function(error){
                    android.endLoading();
                    var resultData=error.responseText.substring(9,(error.responseText).length-1);
                    android.print(resultData);

                    resultData = eval("["+resultData+"]");
                    if(resultData[0].Code=="400"){
                        android.showToast(resultData[0].Msg);
                    }else if(resultData[0].Code=="200"){
                        android.showToast(resultData[0].Msg);
                        $('#StateView').val("复绕中");
                    }
//                    if(resultData=="{\"Code\":\"200\",\"Msg\":\"保存成功\",\"Data\":\"\"}"){
//                        android.showToast("保存成功");
//                        android.print("保存成功啦："+JSON.stringify(error));
//                        $('#StateView').val("复绕中");
//                    }else{
//                        android.showToast("保存失败");
//                    }
                }
            });
        });
    }

    //复绕完成
    function finishFr() {
        $('#finishBtn').click(function () {
            var jitai_code=$('#jitai_code').val();//复绕机台
            var OrdrLen=$('#OrdrLen').val();//复绕长度
            var operatorname=$('#operatorname').val();//作业人员
            var operatortime=$('#operatortime').val();//作业时间
            var StateView=$('#StateView').val();//状态
            var fr_speed=$('#fr_speed').val();//复绕线速

            var shou_zhangli=$('#shou_zhangli').val();//收线张力
            var fang_zhangli=$('#fang_zhangli').val();//放线张力
            var sp_line_state=$('#sp_line_state').val();//收排线状况
            var SPXJieJu=$('#shoupaiJJ').val();//收排线状况
            var SPXZhiJing=$('#shoupanZJ').val();//收线张力
            var SPXZhuangKuang=$('#sp_line_state').val();//放线张力
            var storage=$('#storage').val();//目标仓库

            if(jitai_code=="" || jitai_code==null){
                android.showToast("复绕机台不能为空");
                return;
            }
            if(OrdrLen=="" || OrdrLen==null){
                android.showToast("复绕长度不能为空");
                return;
            }
            if(operatorname=="" || operatorname==null){
                android.showToast("作业人员不能为空");
                return;
            }
            if(operatortime=="" || operatortime==null){
                android.showToast("作业时间不能为空");
                return;
            }
            if(StateView=="" || StateView==null){
                android.showToast("状态不能为空");
                return;
            }
            if(fr_speed=="" || fr_speed==null){
                android.showToast("复绕线速不能为空");
                return;
            }
            if(shou_zhangli=="" || shou_zhangli==null){
                android.showToast("收线张力不能为空");
                return;
            }
            if(fang_zhangli=="" || fang_zhangli==null){
                android.showToast("放线张力不能为空");
                return;
            }
            if(sp_line_state=="" || sp_line_state==null){
                android.showToast("收排线状况不能为空");
                return;
            }
            if(storage=="" || storage==null){
                android.showToast("目标仓库不能为空");
                return;
            }

            $('#myModal').on('shown.bs.modal', function (e) {
                // 关键代码，如没将modal设置为 block，则$modala_dialog.height() 为零
                $(this).css('display', 'block');
                var modalHeight=$(window).height() / 2 - $('#myModal .modal-dialog').height() / 2;
                $(this).find('.modal-dialog').css({
                    'margin-top': modalHeight
                });
            }).modal({
                keyboard:true//当按下esc键时，modal框消失
            });
        });
    }

    //确定复绕完成
    function sureFinishBtn() {
        var guid=$('#GUID').html();
        var ocode="";//操作者编码
        var dt=$('#operatortime').val();
        android.print(guid);
        android.startLoading();
        xgxx.ajax('ZSFiberrepair/EndZSFiberRepair?callback=callback',{
            data:{
                flag:1,
                guid:guid,
                dt:dt,
                ocode:ocode,
                oname:myusername
            },
            success: function (result, status) {
                android.endLoading();
                if(result.Code=="200"){
                    android.showToast("复绕完成");
                    android.closeActivity();
                }else{
                    android.showToast(result.Msg);
                }
                $('#myModal').modal('hide');
            },
            error: function (error) {
                android.endLoading();
                android.print(JSON.stringify(error));
            }
        });
    }

    //清除复绕信息
    function clearInfo() {
        $('#clearBtn').click(function () {
            var guid=$('#GUID').html();
            xgxx.ajax('ZSFiberrepair/ClearZSFiberRepair?callback=callback',{
                data:{
                    flag:1,
                    guid:guid
                },
                success: function (result, status) {
                    android.endLoading();
                    if(result.Code=="200"){
                        android.showToast("数据清除完成");
                        $('#jitai_code').val("");//复绕机台
                        $('#OrdrLen').val("");//复绕长度
                        $('#StateView').val("");//状态
                        $('#fr_speed').val("");//复绕线速
                        $('#shou_zhangli').val("");//收线张力
                        $('#fang_zhangli').val("");//放线张力
                        $('#sp_line_state').val("");//收排线状况
                        $('#slide2_remark').val("");//备注
                        $('#shoupanZJ').val("");//收线盘直径
                        $('#shoupaiJJ').val("");//收线盘节距
                        $('#luWen').val("");//固化炉温度
                        window.location.reload();//刷新当前页面.
                    }else{
                        android.showToast(result.Msg);
                    }
                },
                error: function (error) {
                    android.endLoading();
                    android.print(JSON.stringify(error));
                }
            });
        });
    }


    function initPicker(jsonData) {
        //级联示例
        var cityPicker = new mui.PopPicker({
            layer: 2
        });
        cityPicker.setData(jsonData);
        document.getElementById('jitai_code').addEventListener('tap', function(event) {
            cityPicker.show(function(items) {
                document.getElementById('jitai_code').value = items[0].text + " " + items[1].text;
                $('#jitai_code').data("Code",items[1].value);
                //返回 false 可以阻止选择框的关闭
                //return false;
            });
        }, false);
        android.endLoading();
    }

//    function showTable(jsonData) {
//        console.log(JSON.stringify(jsonData));
//        $("#formBody").append('<tr><td class="antoLine">'+jsonData[i].衰减1310a端+'</td><td class="antoLine">'+jsonData[i].事件起始点+'</td><td class="antoLine">'+jsonData[i].事件参照点+'</td><td class="antoLine">'+jsonData[i].废纤长度+'</td><td class="antoLine">'+jsonData[i].衰减1310+'</td></tr>');
//    }

</script>
</body>
</html>
