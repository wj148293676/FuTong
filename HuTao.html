<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>护套工序执行</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/swiper.min.css">
    <link rel="stylesheet" href="css/hutao.css">
    <link rel="stylesheet" href="css/loading.css">
</head>
<body>
<div class="swiper-container">
    <div class="swiper-wrapper">
        <!--缆芯-->
        <div class="swiper-slide">
            <div class="page-group">
                <div class="page page-current">
                    <!-- 你的html代码 -->
                    <h5 class="page-title">缆芯</h5>
                    <div class="panel-body" style="padding: 10px;">
                        <table id="header_table" class="table table-bordered" style="table-layout:fixed;">
                            <thead>
                                <tr>
                                    <th style="width: 50px"></th>
                                    <th>生产批号</th>
                                    <th>任务单号</th>
                                    <th>客户名称</th>
                                    <th>规格</th>
                                    <th style="width: 70px;">标记</th>
                                    <th style="width: 70px;">长度(m)</th>
                                    <th style="display: none"></th>
                                    <th style="display: none"></th>
                                </tr>
                            </thead>
                        </table>
                        <div id="query-tableDiv" style="margin-top: -20px;">
                            <div id="tablebodyDiv" style="width: 100%;overflow-y: auto;">
                                <table class="table table-bordered" style="table-layout:fixed;">
                                    <tbody id="formBody">
                                    <script type="text/template" charset="UTF-8" id="template">
                                        {{if(it && it.length>0){}}
                                        {{for(var i=0; i < it.length; i++){}}
                                        <tr class="task" id="task{{=(i+1)}}">
                                            <th class="index-th" scope="row" style="width: 50px;">{{=(i+1)}}</th>
                                            <td>{{=it[i].BatchNum}}</td><!-- 生产批号0 -->
                                            <td>{{=it[i].PactCode}}</td><!-- 任务单号1 -->
                                            <td>{{=it[i].CNNAME}}</td><!-- 客户名称2 -->
                                            <td>{{=it[i].Spec}}</td><!-- 规格3 -->
                                            <td style="width: 70px;">{{=it[i].ProductType}}</td><!-- 标记4 -->
                                            <td style="width: 70px;">{{=it[i].OSHTLEN}}</td><!-- 长度5 -->
                                            <td style="display: none;">{{=it[i].ChildType}}</td><!-- 6 护套的子件类别 1为光缆 2 为护套 -->
                                            <td style="display: none;">{{=it[i].Receive_State}}</td><!-- 7 收料状态，true为已收料，false为未收料 -->
                                        </tr>
                                        <tr id="taskshow{{=(i+1)}}" class="task-show" style="display: none;">
                                            <td colspan="7">
                                                <div class="row line-row">
                                                    <div class="col-md-4 col-xs-4">
                                                        <p class="text-center hujiao-title"></p>
                                                        <div class="text-center hujiao-number bianhao"></div>
                                                    </div>
                                                    <div class="col-md-4 col-xs-4">
                                                        <p class="text-center hujiao-title"></p>
                                                        <div class="text-center hujiao-number guige"></div>
                                                    </div>
                                                    <div class="col-md-4 col-xs-4">
                                                        <p class="text-center hujiao-title">长度(m)</p>
                                                        <div class="text-center hujiao-number changdu"></div>
                                                    </div>
                                                    <div class="col-md-4 col-xs-4 hide-data">
                                                        <p class="text-center hujiao-title">FEED_ID</p>
                                                        <div class="text-center hujiao-number feed_id_data"></div>
                                                    </div>
                                                    <div class="col-md-4 col-xs-4 hide-data">
                                                        <p class="text-center hujiao-title">BatchNum</p>
                                                        <div class="text-center hujiao-number batch_num_data"></div>
                                                    </div>
                                                    <div class="col-md-4 col-xs-4 hide-data">
                                                        <p class="text-center hujiao-title">ToFeed_date</p>
                                                        <div class="text-center hujiao-number ToFeed_date"></div>
                                                    </div>
                                                    <div class="col-md-4 col-xs-4 hide-data">
                                                        <p class="text-center hujiao-title">Receive_date</p>
                                                        <div class="text-center hujiao-number receive_date_data"></div>
                                                    </div>
                                                    <div class="col-md-4 col-xs-4 hide-data">
                                                        <p class="text-center hujiao-title">Storage_date</p>
                                                        <div class="text-center hujiao-number storage_data"></div>
                                                    </div>
                                                </div>
                                                <div class="row line-row">
                                                    <div class="col-md-6 col-xs-6">
                                                        <!--<p class="text-center hujiao-title">等待时间：<span class="waittingTime"></span></p>-->
                                                    </div>
                                                    <div class="col-md-6 col-xs-6">
                                                        <button class="order-btn gradient" style="margin-top: -10px;line-height: 30px;font-size: 16px;">叫料</button>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        {{}}}
                                        {{}}}
                                    </script>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--护套料-->
        <div class="swiper-slide">
            <div class="page-group">
                <div class="page page-current">
                    <h5 class="page-title">护套料</h5>
                    <div class="panel-body" style="padding: 10px;">
                        <table id="header_table2" class="table table-bordered" style="table-layout:fixed;">
                            <thead>
                                <tr>
                                    <th style="width: 50px;"></th>
                                    <th>生产批号</th>
                                    <th>任务单号</th>
                                    <th>客户名称</th>
                                    <th>规格</th>
                                    <th style="width: 70px;">标记</th>
                                    <th style="width: 70px;">长度(m)</th>
                                    <th style="display: none;"></th>
                                </tr>
                            </thead>
                        </table>
                        <div id="query-tableDiv2" style="margin-top: -20px;">
                            <div id="tablebodyDiv2" style="width: 100%;overflow-y: auto;">
                                <table class="table table-bordered" style="table-layout:fixed;">
                                    <tbody id="formBody_hutaoliao">
                                    <script type="text/template" charset="UTF-8" id="template2">
                                        {{if(it && it.length>0){}}
                                        {{for(var i=0; i < it.length; i++){}}
                                        <tr class="task2" id="task_hutao_{{=(i+1)}}">
                                            <th class="index-th" scope="row" style="width: 50px;">{{=(i+1)}}</th>
                                            <td>{{=it[i].BatchNum}}</td><!-- 生产批号0 -->
                                            <td>{{=it[i].PactCode}}</td><!-- 任务单号1 -->
                                            <td>{{=it[i].CNNAME}}</td><!-- 客户名称2 -->
                                            <td>{{=it[i].Spec}}</td><!-- 规格3 -->
                                            <td style="width: 70px;">{{=it[i].ProductType}}</td><!-- 标记4 -->
                                            <td style="width: 70px;">{{=it[i].OSHTLEN}}</td><!-- 长度5 -->
                                            <td style="display: none;">{{=it[i].ChildType}}</td><!-- 6 护套的子件类别 1为光缆 2 为护套 -->
                                        </tr>
                                        <tr id="taskshow_hutao_{{=(i+1)}}" class="task-show" style="display: none;">
                                            <td colspan="7">
                                                <div class="row line-row" style="padding-bottom: 5%">
                                                    <div class="col-md-6 col-xs-6">
                                                        <p class="text-center htliao_category" style="display: inline;font-size: 18px;">护套料类别：</p>
                                                        <select class="htliao_type" style="width: 60%;height: 40px;"></select>
                                                    </div>
                                                    <div class="col-md-6 col-xs-6">
                                                        <button class="order-btn gradient" style="margin-top: -12px;outline: none;">叫料</button>
                                                    </div>
                                                    <div class="htliao_feed_id" style="display: none;"></div>
                                                </div>
                                            </td>
                                        </tr>
                                        {{}}}
                                        {{}}}
                                    </script>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--钢铝带-->
        <div class="swiper-slide">
            <h5 class="page-title">钢铝带</h5>
            <div class="panel-body" style="padding: 10px;">
                <table id="header_table3" class="table table-bordered" style="table-layout:fixed;">
                    <thead>
                        <tr>
                            <th style="width: 50px;"></th>
                            <th>生产批号</th>
                            <th>任务单号</th>
                            <th>客户名称</th>
                            <th>规格</th>
                            <th style="width: 70px;">标记</th>
                            <th style="width: 70px;">长度(m)</th>
                            <th style="display: none;"></th>
                        </tr>
                    </thead>
                </table>
                <div id="query-tableDiv3" style="margin-top: -20px;">
                    <div id="tablebodyDiv3" style="width: 100%;overflow-y: auto;">
                        <table class="table table-bordered" style="table-layout:fixed;">
                            <tbody id="formBody_ganglvdai">
                            <script type="text/template" charset="UTF-8" id="template3">
                                {{if(it && it.length>0){}}
                                {{for(var i=0; i < it.length; i++){}}
                                <tr class="task3" id="task_lvdai_{{=(i+1)}}">
                                    <th class="index-th" scope="row" style="width: 50px;">{{=(i+1)}}</th>
                                    <td>{{=it[i].BatchNum}}</td><!-- 生产批号0 -->
                                    <td>{{=it[i].PactCode}}</td><!-- 任务单号1 -->
                                    <td>{{=it[i].CNNAME}}</td><!-- 客户名称2 -->
                                    <td>{{=it[i].Spec}}</td><!-- 规格3 -->
                                    <td style="width: 70px;">{{=it[i].ProductType}}</td><!-- 标记4 -->
                                    <td style="width: 70px;">{{=it[i].OSHTLEN}}</td><!-- 长度5 -->
                                    <td style="display: none;">{{=it[i].ChildType}}</td><!-- 6 护套的子件类别 1为光缆 2 为护套 -->
                                </tr>
                                <tr id="taskshow_lvdai_{{=(i+1)}}" class="task-show" style="display: none;">
                                    <td colspan="7">
                                        <div class="row line-row">
                                            <div class="col-md-8 col-xs-8">
                                                <table class="inner-table inner-table-border" style="width: 100%;margin-top: -20px;margin-bottom: 20px;" rules="1px">
                                                    <thead>
                                                        <tr>
                                                            <th style="border: 0px solid #aaaaaa;background: #ffffff">物料名称</th>
                                                            <th style="border: 0px solid #aaaaaa;background: #ffffff">物料规格</th>
                                                            <th style="display: none">FEED_ID</th>
                                                            <th style="display: none">ToFeed_date</th>
                                                            <th style="display: none">Receive_date</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td style="border: 0px solid #aaaaaa"></td>
                                                            <td style="border: 0px solid #aaaaaa"></td>
                                                            <td style="display: none"></td>
                                                            <td style="display: none"></td>
                                                            <td style="display: none"></td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="col-md-4 col-xs-4">
                                                <button class="order-btn gradient" style="margin-top: -12px;margin-bottom: 18px;">叫料</button>
                                            </div>
                                            <div id="gldai_feed_id" style="display: none;"></div>
                                        </div>
                                    </td>
                                </tr>
                                {{}}}
                                {{}}}
                            </script>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <!--统计分析-->
        <div class="swiper-slide">
            <h5 class="page-title">生产、质量统计分析（当班次）</h5>
            <!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
            <!--<div id="main" style="width: 600px;height:400px;"></div>-->
            <div class="container">
                <div class="pi_titleDiv row">
                    <h3 class="center-block text-center"></h3>
                </div>
                <div class="row">
                    <div class="col-md-6 col-xs-6" style="padding: 0;margin-bottom: -20px;">
                        <h3 class="text-center center-block">生产状况</h3>
                        <div id="productDiv" class="center-block" style="margin-top: -80px" onclick="openShowActivity('product')"></div>
                        <!--<div id="pro_length" class="center-block text-center length-p"></div>-->
                    </div>
                    <div class="col-md-6 col-xs-6" style="padding: 0;margin-bottom: -20px;">
                        <h3 class="text-center center-block">质量状况</h3>
                        <div id="qulityDiv" class="center-block" style="margin-top: -80px" onclick="openShowActivity('qulity')"></div>
                        <!--<div id="ok_length" class="center-block text-center length-p"></div>-->
                    </div>
                </div>
            </div>
        </div>
        <!--待检-->
        <div class="swiper-slide">
            <h5 class="page-title">待检</h5>
            <div class="panel-body" style="padding: 10px;">
                <table id="daijian_table" class="table table-bordered" style="table-layout:fixed;">
                    <thead>
                    <tr>
                        <th style="width: 50px;">序号</th>
                        <th style="width: 120px;">编号</th>
                        <th>规格</th>
                        <th>盘长(m)</th>
                        <th>作业人员</th>
                        <th style="width: 160px;">下机时间</th>
                        <th>状态</th>
                    </tr>
                    </thead>
                </table>
                <div id="query-tableDiv4" style="margin-top: -20px;">
                    <div id="tablebodyDiv4" style="width: 100%;overflow-y: auto;">
                        <table class="table table-bordered" style="table-layout:fixed;">
                            <tbody id="formBody_daijian">
                                <script type="text/template" charset="UTF-8" id="template_daijian">
                                    {{if(it && it.length>0){}}
                                        {{for(var i=0; i < it.length; i++){}}
                                            <tr class="task" id="task_daijian{{=(i+1)}}">
                                                <th class="index-th" scope="row" style="width: 50px;">{{=(i+1)}}</th>
                                                <td style="width: 120px;">{{=it[i].编号}}</td>
                                                <td>{{=it[i].规格}}</td>
                                                <td>{{=it[i].盘长}}</td>
                                                <td>{{=it[i].作业人员}}</td>
                                                <td style="width: 160px;">{{=it[i].下机时间}}</td>
                                                <td>{{=it[i].状态}}</td>
                                            </tr>
                                        {{}}}
                                    {{}}}
                                </script>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--loading-->
<div id="loading" class="spinner" style="z-index: 1000;">
    <div class="bounce1"></div>
    <div class="bounce2"></div>
    <div class="bounce3"></div>
</div>

<div id="overlay"></div>

<!--弹出框-确认收料-(缆芯弹框)-->
<div id="confirmDiv">
    <div class="confirm_titleDiv row" style="margin:0px;">
        <div class="">
            <p id="confirm_title_p" class="text-center">收 料 确 认</p>
        </div>
    </div>
    <div class="confirm_bodyDiv row" style="margin:0px;">
        <div class="col-md-3 col-xs-3">
            <p class="text-center hujiao-title">盘具编号</p>
            <p class="text-center data-content" style="font-size: 14px"></p>
        </div>
        <div class="col-md-3 col-xs-3">
            <p class="text-center hujiao-title">物料编号</p>
            <p class="text-center data-content" style="font-size: 14px"></p>
        </div>
        <div class="col-md-3 col-xs-3">
            <p class="text-center hujiao-title">物料规格</p>
            <p class="text-center data-content" style="font-size: 14px"></p>
        </div>
        <div class="col-md-3 col-xs-3">
            <p class="text-center hujiao-title">长度(m)</p>
            <p class="text-center data-content" style="font-size: 14px"></p>
        </div>
    </div>
    <div class="confirm_footerDiv row" style="margin:0px;">
        <div class="row">
            <div class="col-xs-6">
                <p id="sure_btn" class="center-block text-center btn_p gradient" style="background: #3db746;color: #fff;" onclick="sureReceive()">确定</p>
            </div>
            <div class="col-xs-6">
                <p id="cancle_btn" class="center-block text-center btn_p" style="background: #3db746;color: #ffffff;" onclick="cancleReceive()">取消</p>
            </div>
        </div>
    </div>
</div>

<!--弹出框-确认收料-(护套料弹框)-->
<div id="confirmDiv_htliao">
    <div class="confirm_titleDiv row" style="margin:0px;">
        <div class="">
            <p id="confirm_title_htliao_p" class="text-center">护套料收料确认</p>
        </div>
    </div>
    <div class="confirm_bodyDiv row" style="margin:0px;">
        <div class="row" style="margin-top: 20px;">
            <div class="col-md-4 col-xs-4">
                <p class="htliao_title_p text-right">批次号：</p>
            </div>
            <div class="col-md-8 col-xs-8">
                <input class="htliao_input batch_input" type="text" style="width: 60%">
            </div>
        </div>
        <div class="row" style="margin-top: 20px;">
            <div class="col-md-4 col-xs-4">
                <p class="htliao_title_p text-right">厂家：</p>
            </div>
            <div class="col-md-8 col-xs-8">
                <input class="htliao_input vender_input" type="text" style="width: 60%">
            </div>
        </div>
    </div>
    <div class="confirm_footerDiv row" style="margin:0px;">
        <div class="row">
            <div class="col-xs-6">
                <p id="ht_liao_sure_btn" class="center-block text-center btn_p gradient" style="background: #3db746;color: #fff;" onclick="htliao_sureReceive()">确定</p>
            </div>
            <div class="col-xs-6">
                <p id="ht_liao_cancle_btn" class="center-block text-center btn_p" style="background: #3db746;color: #ffffff;" onclick="htliao_cancleReceive()">取消</p>
            </div>
        </div>
    </div>
</div>

<!--弹出框-确认收料-(钢铝带弹框)-->
<div id="confirmDiv_gldai">
    <div class="confirm_titleDiv row" style="margin:0px;">
        <div class="">
            <p id="confirm_title_gldai_p" class="text-center">钢铝带收料确认</p>
        </div>
    </div>
    <div class="confirm_bodyDiv row" style="margin:0px;">
        <div class="row" style="margin-top: 20px;">
            <div class="col-md-4 col-xs-4">
                <p class="htliao_title_p text-right">批次号：</p>
            </div>
            <div class="col-md-8 col-xs-8">
                <input class="htliao_input batch_input" type="text" style="width: 60%">
            </div>
        </div>
        <div class="row" style="margin-top: 20px;">
            <div class="col-md-4 col-xs-4">
                <p class="htliao_title_p text-right">厂家：</p>
            </div>
            <div class="col-md-8 col-xs-8">
                <input class="htliao_input vender_input" type="text" style="width: 60%">
            </div>
        </div>
    </div>
    <div class="confirm_footerDiv row" style="margin:0px;">
        <div class="row">
            <div class="col-xs-6">
                <p id="gldai_sure_btn" class="center-block text-center btn_p gradient" style="background: #3db746;color: #fff;" onclick="gldai_sureReceive()">确定</p>
            </div>
            <div class="col-xs-6">
                <p id="gldai_cancle_btn" class="center-block text-center btn_p" style="background: #3db746;color: #ffffff;" onclick="gldai_cancleReceive()">取消</p>
            </div>
        </div>
    </div>
</div>

<!--提示对话框-->
<div id="alertDiv" style="display: none;border: 2px solid #3A89ED;">
    <div class="confirm_titleDiv row" style="margin:0px;">
        <div class="">
            <p id="alert_title_p" class="text-center">提示消息</p>
        </div>
    </div>
    <div class="confirm_bodyDiv row" style="margin:0px;height: 150px;overflow-y: auto">
        <p id="alert_p" class="text-center" style="line-height: 150px"></p>
    </div>
    <div class="confirm_footerDiv row" style="margin:0px;margin-top: 30px;">
        <div class="row">
            <div class="col-xs-3"></div>
            <div class="col-xs-6">
                <p id="sure_btn2" class="center-block text-center btn_p gradient" style="background: #3db746;color: #fff;" onclick="sureAlert()">确定</p>
            </div>
            <div class="col-xs-3"></div>
        </div>
    </div>
</div>


<script type="text/javascript" src="js/doT.js"></script>
<script type='text/javascript' src='js/jquery-2.0.3.min.js' charset='utf-8'></script>
<script type='text/javascript' src='js/bootstrap.min.js' charset='utf-8'></script>
<script type="text/javascript" src="js/swiper.min.js"></script>
<script type="text/javascript" src="js/echarts.js"></script>
<script type="text/javascript" src="js/ftcommon.js"></script>
<script type="text/javascript">
    var template;
    var template2;
    var template3;
    var template_daijian;
    var my_macno;
    var myusername;
    var Timer;
    var publicNum;
    var publicNum_hutao;
    var publicNum_ganglvdai;
    var jiaoliaoTime;
    var jiaoliaoTime_hutaoliao;
    var jiaoliaoTime_ganglvdai;
    $(function(){
        android.windowReady();
        $('#tablebodyDiv').height(windowHeight()-$('#header_table').height()-60);
        $('#tablebodyDiv2').height(windowHeight()-$('#header_table2').height()-60);
        $('#tablebodyDiv3').height(windowHeight()-$('#header_table3').height()-60);
        $('#tablebodyDiv4').height(windowHeight()-$('#daijian_table').height()-60);
        template = document.getElementById('template').innerHTML;
        template2 = document.getElementById('template2').innerHTML;
        template3 = document.getElementById('template3').innerHTML;
        template_daijian = document.getElementById('template_daijian').innerHTML;
        initSwiper();//初始化swiper
        initPopup();
        initAlertDiv();
    });

    //设置用户名
    function setusername(username) {
        myusername=username;
    }

    //初始化消息对话框
    function initAlertDiv() {
        adjust(alertDiv);
    }
    //提示对话框的确定按钮
    function sureAlert() {
        $('#alertDiv').hide();
    }
    //初始化swiper
    function initSwiper() {
        $('.swiper-container').height($(window).height());
        var mySwiper = new Swiper ('.swiper-container', {
            direction: 'horizontal',
            loop: false,
            onSlideChangeEnd: function(swiper){
                android.choose_tab(swiper.activeIndex+1);
            }
        });
    }

    //初始化弹出框
    function initPopup() {
        var popHeight = pageHeight()*0.4;
        //缆芯弹出框初始化
        $('#confirmDiv').css('height',popHeight);
        $('#confirmDiv').find('.confirm_titleDiv').css('height',popHeight*0.2+"px");
        $('#confirmDiv').find('.confirm_bodyDiv').css('height',popHeight*0.6+"px");
        $('#confirmDiv').find('.confirm_footerDiv').css('height',popHeight*0.2+"px");
        $('#confirmDiv').find('.btn_p').css('margin-top',(popHeight*0.2-40)/2-25+"px");
        $('#confirm_title_p').css('line-height',popHeight*0.2+'px');
        adjust(confirmDiv);
        $('#overlay').click(function () {
            $('#confirmDiv').hide();
        });
        //护套料弹出框初始化
        $('#confirmDiv_htliao').css('height',popHeight);
        $('#confirmDiv_htliao').find('.confirm_titleDiv').css('height',popHeight*0.2+"px");
        $('#confirmDiv_htliao').find('.confirm_bodyDiv').css('height',popHeight*0.6+"px");
        $('#confirmDiv_htliao').find('.confirm_footerDiv').css('height',popHeight*0.2+"px");
        $('#confirmDiv_htliao').find('.btn_p').css('margin-top',(popHeight*0.2-40)/2-25+"px");
        $('#confirm_title_htliao_p').css('line-height',popHeight*0.2+'px');
        adjust(confirmDiv_htliao);
        //钢铝带弹出框初始化
        $('#confirmDiv_gldai').css('height',popHeight);
        $('#confirmDiv_gldai').find('.confirm_titleDiv').css('height',popHeight*0.2+"px");
        $('#confirmDiv_gldai').find('.confirm_bodyDiv').css('height',popHeight*0.6+"px");
        $('#confirmDiv_gldai').find('.confirm_footerDiv').css('height',popHeight*0.2+"px");
        $('#confirmDiv_gldai').find('.btn_p').css('margin-top',(popHeight*0.2-40)/2-25+"px");
        $('#confirm_title_gldai_p').css('line-height',popHeight*0.2+'px');
        adjust(confirmDiv_gldai);
    }


    //获取任务明细表
    function getTaskList(macno,server_Domain) {
        xgxx.server_Domain=server_Domain;
        document.getElementById('formBody').innerHTML = doT.template(template)("");
        document.getElementById('formBody_hutaoliao').innerHTML = doT.template(template2)("");
        document.getElementById('formBody_ganglvdai').innerHTML = doT.template(template3)("");
        document.getElementById('formBody_daijian').innerHTML = doT.template(template_daijian)("");
        my_macno=macno;
        android.startLoading();
        if(macno=='mac000'){
            setTimeout(function () {
                android.endLoading();
                closeLoading();
            },1000);
            var jsonData = eval('[{"BatchNum":"17060324-401-1","Spec":"GYTA-24φ1.84*5(6*4)-Q-v7YD","OSHTLEN":24058.000000,"ProductType":"GYTA","BOMGuid":"112cf445-35ae-41a0-8a46-16623f7b7e34","ChildType":2,"CNNAME":"中国移动","Mac_Code":"mac602","Plan_Start1":"2017-06-26T00:10:13","Receive_State":"0","PactCode":"SFC-1706002"},{"BatchNum":"17060325-401","Spec":"GYTA-24φ1.84*5(6*4)-Q-v7YD","OSHTLEN":21056.000000,"ProductType":"GYTA","BOMGuid":"112cf445-35ae-41a0-8a46-16623f7b7e34","ChildType":2,"CNNAME":"中国移动","Mac_Code":"mac602","Plan_Start1":"2017-06-28T09:33:37.577","Receive_State":"0","PactCode":"SFC-1706002"}]');
            document.getElementById('formBody').innerHTML = doT.template(template)(jsonData);
            document.getElementById('formBody_hutaoliao').innerHTML = doT.template(template2)(jsonData);
            document.getElementById('formBody_ganglvdai').innerHTML = doT.template(template3)(jsonData);
            initEcharts();
            //缆芯
            $('.task').click(function () {
                var line_id = $(this).attr('id');
                var num = $(this).find('th').eq(0).html();
                publicNum = num;
                if($("#taskshow"+num).is(":hidden")){
                    $('.task-show').hide();
                    $("#taskshow"+num).show();
                    var jsonData = eval('[{"FEED_ID":9999,"BatchNum":"17060325-401","CHILDCODE":"17060325-201","CHILDTYPE":1,"SPEC":"GYT-24φ1.84*5(6*4)-Q-v1","OShtLen":21120.118636}]');
                    $("#taskshow"+num).find('.order-btn').eq(0).html('叫料');
                    $('#taskshow'+num).find('.hujiao-title').eq(0).html("缆芯编号");
                    $('#taskshow'+num).find('.hujiao-title').eq(1).html("缆芯规格");
                    $('#taskshow'+num).find('.bianhao').html(jsonData[0].CHILDCODE);
                    $('#taskshow'+num).find('.guige').html(jsonData[0].SPEC);
                    $('#taskshow'+num).find('.changdu').html(jsonData[0].OShtLen);
                    $("#taskshow"+num).find('.order-btn').eq(0).click(function () {
                        $('#confirmDiv').find('.data-content').eq(0).html('X064');//盘具编号

                        $('#confirmDiv').find('.hujiao-title').eq(1).html('缆芯编号');
                        $('#confirmDiv').find('.data-content').eq(1).html('17060324-401-1');//内护套编号

                        $('#confirmDiv').find('.hujiao-title').eq(2).html('缆芯规格');
                        $('#confirmDiv').find('.data-content').eq(2).html('GYTA-24φ1.84*5(6*4)-Q-v7YD');//内护套规格
                        $('#confirmDiv').find('.data-content').eq(3).html('21120.11');//长度
                        $('#confirmDiv').show();
                    });
                }else{
                    $("#taskshow"+num).hide();
                }
            });
            //护套料
            $('.task2').click(function () {
                var line_id = $(this).attr('id');
                var num = $(this).find('th').eq(0).html();
                publicNum_hutao = num;
                if($("#taskshow_hutao_"+num).is(":hidden")){
                    $('.task-show').hide();
                    $("#taskshow_hutao_"+num).show();
                    var jsonData = eval('[{"htliao":"B级护套料"}]');
                    $('#taskshow_hutao_'+num).find(".htliao_type").html("");
                    for(var i=0; i<jsonData.length; i++){
                        $('#taskshow_hutao_'+num).find(".htliao_type").append("<option value='"+jsonData[i]['htliao']+"'>"+jsonData[i]['htliao']+"</option>");
                    }
                    $("#taskshow_hutao_"+num).find('.order-btn').eq(0).click(function () {
                        android.showToast("叫料成功！");
                    });
                }else{
                    $("#taskshow_hutao_"+num).hide();
                }
            });
            //钢铝带
            $('.task3').click(function () {
                var line_id = $(this).attr('id');
                var num = $(this).find('th').eq(0).html();
                publicNum_ganglvdai = num;
                if($("#taskshow_lvdai_"+num).is(":hidden")){
                    $('.task-show').hide();
                    var BATCHNUM = $(this).children('td').eq(0)[0].innerHTML;//厂商
                    var CHILDTYPE = $(this).children('td').eq(6)[0].innerHTML;//种类
                    $("#taskshow_lvdai_"+num).show();
                    $('#taskshow_lvdai_'+num).find('table tbody').find('td').eq(0).html("镀锡钢带");
                    $('#taskshow_lvdai_'+num).find('table tbody').find('td').eq(1).html('0.25a*21');
                    $("#taskshow_lvdai_"+num).find('.order-btn').eq(0).click(function () {
                        if($("#taskshow_lvdai_"+num).find('.order-btn').eq(0).html()=="叫料"){
                            android.showToast("叫料成功");
                            $("#taskshow_lvdai_"+num).find('.order-btn').eq(0).html("收料");
                            $('#confirmDiv_gldai').show();
                        }else{
                            $('#confirmDiv_gldai').show();
                        }
                    });
                }else{
                    $("#taskshow_lvdai_"+num).hide();
                }
            });
            return;
        }else{
            xgxx.ajax('SheathExec/GetSheathTask?callback=callback',{
                data:{
                    maccode:my_macno
                },
                success: function (result, status) {
                    initEcharts();//初始化echarts
                    var jsonData = eval(result.Data);
                    jsonData = NullToBlank(jsonData);
                    //加载缆芯列表
                    document.getElementById('formBody').innerHTML = doT.template(template)(jsonData);
                    //加载护套料列表
                    document.getElementById('formBody_hutaoliao').innerHTML = doT.template(template2)(jsonData);
                    //加载钢铝带列表
                    document.getElementById('formBody_ganglvdai').innerHTML = doT.template(template3)(jsonData);

                    //缆芯列表如果该行为已叫料状态，则为绿色
                    for(var k=0; k<jsonData.length; k++){
                        if(jsonData[k].Receive_State=="1" || jsonData[k].Receive_State==1){
                            $('#task'+(k+1)).find('td').css('background','#1d953f');
                        }
                    }

                    //缆芯
                    $('.task').click(function () {
                        var line_id = $(this).attr('id');
                        var num = $(this).find('th').eq(0).html();
                        publicNum = num;
                        if($("#taskshow"+num).is(":hidden")){
                            $('.task-show').hide();
                            var BATCHNUM = $(this).children('td').eq(0)[0].innerHTML;//厂商
                            var CHILDTYPE = $(this).children('td').eq(6)[0].innerHTML;//种类
                            GetSheathTaskFeedList(BATCHNUM,CHILDTYPE,num);//任务表展开 num--行数
                            $("#taskshow"+num).show();
                        }else{
                            $("#taskshow"+num).hide();
                        }
                    });
                    //护套料
                    $('.task2').click(function () {
                        var line_id = $(this).attr('id');
                        var num = $(this).find('th').eq(0).html();
                        publicNum_hutao = num;
                        if($("#taskshow_hutao_"+num).is(":hidden")){
                            $('.task-show').hide();
                            var BATCHNUM = $(this).children('td').eq(0)[0].innerHTML;//厂商
                            var CHILDTYPE = $(this).children('td').eq(6)[0].innerHTML;//种类
                            GetSheathTaskSheathType(BATCHNUM,num);//获取护套料类别
                            $("#taskshow_hutao_"+num).show();
                        }else{
                            $("#taskshow_hutao_"+num).hide();
                        }
                    });
                    //钢铝带
                    $('.task3').click(function () {
                        var line_id = $(this).attr('id');
                        var num = $(this).find('th').eq(0).html();
                        publicNum_ganglvdai = num;
                        if($("#taskshow_lvdai_"+num).is(":hidden")){
                            $('.task-show').hide();
                            var BATCHNUM = $(this).children('td').eq(0)[0].innerHTML;//厂商
                            var CHILDTYPE = $(this).children('td').eq(6)[0].innerHTML;//种类
                            GetSheathFeedSteelList(BATCHNUM,num);//获取钢铝带类别
                            $("#taskshow_lvdai_"+num).show();
                        }else{
                            $("#taskshow_lvdai_"+num).hide();
                        }
                    });
                },
                error: function (error) {
                    android.endLoading();
                    alert("错误"+JSON.stringify(error));
                }
            });
        }
    }

    /**
     * 缆芯
     * @param time
     * @returns {number}
     */
    //任务表展开
    function GetSheathTaskFeedList(BATCHNUM,CHILDTYPE,num) {
        showLoading();
        android.startLoading();
        xgxx.ajax('SheathExec/GetSheathTaskFeedList?callback=callback',{
            data:{
                batchnum:BATCHNUM,
                childtype:CHILDTYPE,
                user:myusername
            },
            success: function (result, status) {
                android.endLoading();
                closeLoading();
                if(result.Code==400){
                    android.showToast(result.Msg);
                    return;
                }
                var jsonData = eval(result.Data);
//                console.log(JSON.stringify(jsonData));
                android.print("wwwww=============="+JSON.stringify(result));
                if(result.Msg=='OK_EXIST'){
                    $("#taskshow"+num).find('.order-btn').eq(0).html('收料');
                }else if(result.Msg=='OK_NEW_NO'){
//                    $("#taskshow"+num).find('.order-btn').eq(0).attr('disabled',true);
//                    $("#taskshow"+num).find('.order-btn').eq(0).css('background','#cccccc');
                    $('#taskshow'+num).find('.storage_data').html("OK_NEW_NO");
//                    android.showToast('无库存，不能叫料');
                }else{
                    $("#taskshow"+num).find('.order-btn').eq(0).html('叫料');
                }
                var feed_id = jsonData[0].FEED_ID;// 要料ID号
                var batchnum = jsonData[0].BatchNum;// 护套编号/生产批号
                var child_type = jsonData[0].CHILDTYPE;//子件类别 1为光缆 2 为护套
                var child_code = jsonData[0].CHILDCODE;//子件编号(缆芯/护套编号)
                var spec = jsonData[0].SPEC;//规格
                var oshtlen = jsonData[0].OShtLen;//长度
                var receive_date = jsonData[0].Receive_date;//收料时间   如果为空则为未收料
                var ToFeed_date = jsonData[0].ToFeed_date;
                var mac_code = jsonData[0].Mac_Code; // 机床代码
                android.print("child_type:"+child_type);
                android.print("child_code:"+child_code);
                android.print("spec:"+spec);
                android.print("oshtlen:"+oshtlen);
                //根据childtype显示不同标题
                if(child_type == 1){
                    $('#taskshow'+num).find('.hujiao-title').eq(0).html("缆芯编号");
                    $('#taskshow'+num).find('.hujiao-title').eq(1).html("缆芯规格");
                }else if(child_type == 2){
                    $('#taskshow'+num).find('.hujiao-title').eq(0).html("护套编号");
                    $('#taskshow'+num).find('.hujiao-title').eq(1).html("护套规格");
                }
                $('#taskshow'+num).find('.bianhao').html(jsonData[0].CHILDCODE);
                $('#taskshow'+num).find('.guige').html(jsonData[0].SPEC);
                $('#taskshow'+num).find('.changdu').html(jsonData[0].OShtLen);
                $('#taskshow'+num).find('.feed_id_data').html(jsonData[0].FEED_ID);//隐藏字段
                $('#taskshow'+num).find('.batch_num_data').html(jsonData[0].BatchNum);//隐藏字段
                $('#taskshow'+num).find('.receive_date_data').html(jsonData[0].Receive_date);
                $('#taskshow'+num).find('.ToFeed_date').html(jsonData[0].ToFeed_date);
                //根据收料时间判断叫料按钮是否为空
                if(receive_date != null){
                    $("#taskshow"+num).find('.order-btn').eq(0).css('background','#cccccc');
                    $("#taskshow"+num).find('.order-btn').eq(0).attr('disabled','disabled');
//                    $("#taskshow"+num).find('.line-row').eq(0).css('background','#1d953f');
                }
                //点击叫料按钮
                $("#taskshow"+num).find('.order-btn').eq(0).click(function () {
                    if($('#taskshow'+num).find('.storage_data').html()=="OK_NEW_NO"){
                        $('#alert_p').html("该物料缺料，不允许叫料");
                        $('#alertDiv').show();
                        return;
                    }
                    //判断前一条是否已经收料成功
                    if(num>1){
                        var state = $('#task'+(num-1)).find('td').eq(7).html();//上料状态
                        if(state == "1" || state == 1){
                        }else{
                            $('#alert_p').html("前一计划未完成收料，不允许叫料");
                            $('#alertDiv').show();
                            return;
                        }

                        var batchnum = $('#task'+(num-1)).find('td').eq(0).html();//生产批号
                        android.startLoading();
                        xgxx.ajax('SheathExec/SheathCheckLoading?callback=callback',{
                            data:{
                                batchnum:batchnum,
                                childcode:'aaa'
                            },
                            success: function (result, status) {
                                android.endLoading();
                                android.print(JSON.stringify(result));
                                if(result.Code==200 && result.Msg=="已上料"){
                                    //只有缆芯的上一条任务上料，护套料和钢铝带的下一任务才能叫料
                                    var batchnum = $('#task'+num).find('td').eq(0).html();//生产批号
                                    xgxx.ajax('SheathExec/GetSheathTaskStrandByUse?callback=callback',{
                                        data:{
                                            batchnum:batchnum,
                                            maccode:my_macno
                                        },
                                        success: function (result, status) {
                                            closeLoading();
                                            android.print(JSON.stringify(result));
                                            if(result.Msg=="空"){
                                                //开始计时
//                                                $("#taskshow"+num).find('.waittingTime').eq(0).html("");
                                                //调用2.4节的API获取盘具号等信息
                                                GetSheathFeeufhdPlate(feed_id,child_type);
//                                                TimerStart(num);
                                            }else if(result.Msg == "ok"){
                                                $('#confirmDiv .confirm_bodyDiv').html('<p class="share_p center-block">编号为'+child_code+'的缆芯为公用料，该缆芯位于护套工序,的缆芯为公用料，该缆芯位于护套工序'+result.data+'工位，需人工取料'+'</p>');
                                                $('#confirmDiv').show();
                                            }
                                        },
                                        error: function (error) {
                                            closeLoading();
                                            alert("错误"+JSON.stringify(error));
                                        }
                                    });
                                }else if(result.Code==200 && result.Msg=="未上料"){
                                    $('#alert_p').html("前一计划未完成上料，不允许叫料");
                                    $('#alertDiv').show();
                                }else{
                                    $('#alert_p').html(result.Msg);
                                    $('#alertDiv').show();
                                }
                            },
                            error: function (error) {
                                android.endLoading();
                            }
                        });
                    }else{
                        var batchnum = $('#task'+num).find('td').eq(0).html();//生产批号
                        xgxx.ajax('SheathExec/GetSheathTaskStrandByUse?callback=callback',{
                            data:{
                                batchnum:batchnum,
                                maccode:my_macno
                            },
                            success: function (result, status) {
                                closeLoading();
                                android.print(JSON.stringify(result));
                                if(result.Msg=="空"){
                                    //开始计时
                                    $("#taskshow"+num).find('.waittingTime').eq(0).html("");
                                    //调用2.4节的API获取盘具号等信息
                                    GetSheathFeeufhdPlate(feed_id,child_type);
//                                    TimerStart(num);
                                }else if(result.Msg == "ok"){
                                    $('#confirmDiv .confirm_bodyDiv').html('<p class="share_p center-block">编号为'+child_code+'的缆芯为公用料，该缆芯位于护套工序,的缆芯为公用料，该缆芯位于护套工序'+result.data+'工位，需人工取料'+'</p>');
                                    $('#confirmDiv').show();
                                }
                            },
                            error: function (error) {
                                closeLoading();
                                alert("错误"+JSON.stringify(error));
                            }
                        });
                    }
                });
            },
            error: function (error) {
                alert("错误"+JSON.stringify(error));
            }
        });
    }
    //获取盘具号等信息
    function GetSheathFeeufhdPlate(feed_id,child_type) {
        showLoading();
        android.print("feed_id:"+feed_id);
        xgxx.ajax('SheathExec/GetSheathFeedPlate?callback=callback',{
            data:{
                feed_id:feed_id,
                child_type:child_type
            },
            success: function (result, status) {
                closeLoading();
//                console.log(result);
                var jsonData = eval(result.Data);
                android.print(JSON.stringify(jsonData));
                console.log(JSON.stringify(jsonData));
                console.log(jsonData.length);
                if(jsonData.length>0){
                    var plate_no = jsonData[0].PLATENO;// 盘具编号
                    var child_code = jsonData[0].ChildCode;// 内护套编号
                    var spec = jsonData[0].SPEC;//规格
                    var oshtlen = jsonData[0].OShtLen;//长度
                    $('#confirmDiv').find('.data-content').eq(0).html(plate_no);//盘具编号
                    $('#confirmDiv').find('.data-content').eq(1).html(child_code);//内护套编号
                    $('#confirmDiv').find('.data-content').eq(2).html(spec);//内护套规格
                    $('#confirmDiv').find('.data-content').eq(3).html(oshtlen);//长度
                }
                $('#confirmDiv').show();
            },
            error: function (error) {
                closeLoading();
                alert("错误"+JSON.stringify(error));
            }
        });
    }
    //确认收料
    function sureReceive() {

        if(my_macno=="mac000"){
            android.showToast("收料成功");
            $('#confirmDiv').hide();
            $('#task'+publicNum).find('td').css('background','#1d953f');
            $("#taskshow"+publicNum).find('.order-btn').eq(0).attr('disabled',true);
            $("#taskshow"+publicNum).find('.order-btn').eq(0).css('background','#cccccc');
            $("#taskshow"+publicNum).hide();
            return;
        }
        android.startLoading();
        var feed_id_data=$('#taskshow'+publicNum).find('.feed_id_data').html();//隐藏字段
        var ToFeed_date=$('#taskshow'+publicNum).find('.ToFeed_date').html();
        var batch_num_data=$('#taskshow'+publicNum).find('.batch_num_data').html();//隐藏字段
        var receive_date_data=$('#taskshow'+publicNum).find('.receive_date_data').html();//隐藏字段
        var jsonObj={};
        jsonObj['Feed_id']=feed_id_data;
        jsonObj['ToFeed_date']=ToFeed_date;
        jsonObj['Receive_date']=receive_date_data;
        jsonObj['BatchNum']=batch_num_data;
        android.print("savejson:"+JSON.stringify(jsonObj));
        xgxx.ajax('SheathExec/SaveCallSheath?callback=callback',{
            data:{
                savejson:JSON.stringify(jsonObj)
            },
            success: function (result, status) {
                android.endLoading();
                if(result.Msg=="保存成功"){
                    android.showToast("保存成功");
                    $('#confirmDiv').hide();
                    getTaskList(my_macno,xgxx.server_Domain);
                }
            },
            error: function (error) {
                closeLoading();
                alert("错误"+JSON.stringify(error));
            }
        });
    }

    /**
     * 护套料
     * @param time
     * @returns {number}
     */
    //任务表展开,获取护料套类型
    function GetSheathTaskSheathType(BATCHNUM,num){
        android.startLoading();
        android.print(BATCHNUM);
        xgxx.ajax('SheathExec/GetSheathTaskSheathType?callback=callback',{
            data:{
                batchnum:BATCHNUM
            },
            success: function (result, status) {
                android.endLoading();
                if(result.Code==400){
                    android.showToast(result.Msg);
                    return;
                }
//                result.Data='[{"htliao":"A级护套料","flag":"收料","tofeed_date":"2017-10-27T14:07:48.547","feed_id":69,"venderbatch":null,"vender":null}]';
                var jsonData = eval(result.Data);
                android.print(JSON.stringify(jsonData));
                if(jsonData.length<1){
                    $("#taskshow_hutao_"+num).find('.order-btn').eq(0).css('background','#cccccc');
                    $("#taskshow_hutao_"+num).find('.order-btn').eq(0).attr('disabled','disabled');
                    return;
                }
                $('#taskshow_hutao_'+num).find(".htliao_type").html("");
                for(var i=0; i<jsonData.length; i++){
                    $('#taskshow_hutao_'+num).find(".htliao_type").append("<option value='"+jsonData[i]['htliao']+"'>"+jsonData[i]['htliao']+"</option>");
                }
                android.print(jsonData[0].flag);
                if(jsonData[0].flag=="叫料"){
                    $("#taskshow_hutao_"+num).find('.order-btn').eq(0).html("叫料");
                }else if(jsonData[0].flag=="收料"){
                    $("#taskshow_hutao_"+num).find('.order-btn').eq(0).html("收料");
                }else if(jsonData[0].flag=="禁用"){
                    $("#taskshow_hutao_"+num).find('.order-btn').eq(0).html("收料");
                    if(jsonData[0].htliao=="B+级护套料" || jsonData[0].htliao=="B级护套料"){
                        $("#taskshow_hutao_"+num).find('.order-btn').eq(0).css('background','#cccccc');
                        $("#taskshow_hutao_"+num).find('.order-btn').eq(0).attr('disabled','disabled');
                    }
                }
                var tofeed_date = jsonData[0].tofeed_date;
                var feed_id = jsonData[0].feed_id;
                var venderbatch = jsonData[0].venderbatch;
                var vender = jsonData[0].vender;


                $("#taskshow_hutao_"+num).find('.order-btn').eq(0).click(function () {
                    if(num>1){
                        var batchnum = $('#task'+(num-1)).find('td').eq(0).html();//生产批号
                        android.startLoading();
                        xgxx.ajax('SheathExec/SheathCheckLoading?callback=callback',{
                            data:{
                                batchnum:batchnum,
                                childcode:'aaa'
                            },
                            success: function (result, status) {
                                android.endLoading();
                                if(result.Code==200 && result.Msg=="已上料"){
                                    //只有缆芯的上一条任务上料，护套料和钢铝带的下一任务才能叫料
                                    var Mtype = $('#taskshow_hutao_'+num).find(".htliao_type").find("option:selected").text();
                                    GetSheathFeedSheathList(BATCHNUM,Mtype,num,feed_id,tofeed_date,vender,venderbatch);
                                }else if(result.Code==200 && result.Msg=="未上料"){
                                    $('#alert_p').html("前一计划未完成上料，不允许叫料");
                                    $('#alertDiv').show();
                                }else{
                                    $('#alert_p').html(result.Msg);
                                    $('#alertDiv').show();
                                }
                            },
                            error: function (error) {
                                android.endLoading();
                            }
                        });
                    }else{
                        var Mtype = $('#taskshow_hutao_'+num).find(".htliao_type").find("option:selected").text();
                        GetSheathFeedSheathList(BATCHNUM,Mtype,num,feed_id,tofeed_date,vender,venderbatch);
                    }
                });
                //var checkManName = document.getElementById('checkManName').options[document.getElementById('checkManName').selectedIndex].text;//检验人员
            },
            error: function (error) {
                android.endLoading();
                alert("错误"+JSON.stringify(error));
            }
        });
    }
    //点击叫料
    function GetSheathFeedSheathList(BATCHNUM,Mtype,num,feed_id,tofeed_date,vender,venderbatch) {
        var date = new Date();
        android.print("BATCHNUM"+BATCHNUM);
        android.print("Mtype"+Mtype);
        android.print("feed_id:"+feed_id);
        jiaoliaoTime_hutaoliao=Format(date,"yyyy-MM-dd HH:mm:ss");
        var orderbtn = $("#taskshow_hutao_"+num).find('.order-btn').eq(0).html();
        if(orderbtn=="叫料"){
            xgxx.ajax('SheathExec/GetSheathFeedSheathList?callback=callback',{
                data:{
                    batchnum:BATCHNUM,
                    Mtype:Mtype,
                    user:myusername,
                },
                success: function (result, status) {
                    closeLoading();
                    var jsonData = eval(result.Data);
                    android.print(JSON.stringify(result));
                    if(result.Msg=='OK_EXIST' || result.Msg=='OK_NEW'){
                        var type = jsonData[0].ChildCode;//护套料类别
                        var feed_id = jsonData[0].FEED_ID;
                        android.print("type:"+type);
                        android.print("feed_id:"+feed_id);
                        $("#taskshow_hutao_"+num).find('.htliao_feed_id').html(feed_id);
                        if(type=="A级护套料" || type=="C级护套料"){
                            $('#confirmDiv_htliao').show();
                            $('#confirmDiv_htliao').find('.vender_input').eq(0).val("");
                            $('#confirmDiv_htliao').find('.batch_input').eq(0).val("");
                        }else if(type=="B+级护套料" || type=="B级护套料"){
                            //提示叫料成功
                            android.showToast("叫料成功！");
                            refreashTastList(my_macno);
                        }
                    }
                },
                error: function (error) {
                    console.log("错误"+JSON.stringify(error));
                }
            });
        }else if(orderbtn=="收料"){
            if(Mtype=="A级护套料" || Mtype=="C级护套料"){
                $("#taskshow_hutao_"+num).find('.htliao_feed_id').html(feed_id);
                $('#confirmDiv_htliao').show();
                $('#confirmDiv_htliao').find('.vender_input').eq(0).val(vender);
                $('#confirmDiv_htliao').find('.batch_input').eq(0).val(venderbatch);
                return;
            }
            var date = new Date();
            var receive_date_data=Format(date,"yyyy-MM-dd HH:mm:ss");
            var jsonObj={};
            jsonObj['Feed_id']=feed_id;
            jsonObj['ToFeed_date']=tofeed_date;
            jsonObj['Receive_date']=receive_date_data;
            jsonObj['Vender']=vender;
            jsonObj['VenderBatch']=venderbatch;
            xgxx.ajax('SheathExec/SaveCallSheathForSheathM?callback=callback',{
                data:{
                    savejson:JSON.stringify(jsonObj)
                },
                success: function (result, status) {
                    closeLoading();
                    if(result.Msg=="保存成功"){
                        android.showToast("收料成功");
                        getTaskList(my_macno,xgxx.server_Domain);
                    }
                },
                error: function (error) {
                    closeLoading();
                    alert("错误"+JSON.stringify(error));
                }
            });
        }
    }
    //护套料确认收料
    function htliao_sureReceive() {
        var date = new Date();
        var receive_date_data=Format(date,"yyyy-MM-dd HH:mm:ss");
        var Vender = $('#confirmDiv_htliao').find('.vender_input').eq(0).val();
        var VenderBatch = $('#confirmDiv_htliao').find('.batch_input').eq(0).val();
        if(Vender.length<1 || Vender==null || Vender==""){
            android.showToast("请输入厂家名称");
            return;
        }
        if(VenderBatch.length<1 || VenderBatch==null || VenderBatch==""){
            android.showToast("请输入批次号");
            return;
        }
        var feed_id = $("#taskshow_hutao_"+publicNum_hutao).find('.htliao_feed_id').html();
        if(feed_id==null || feed_id==""){
            android.showToast("数据异常，动态叫料号不能为空");
        }
        var jsonObj={};
        jsonObj['Feed_id']=feed_id;
        jsonObj['ToFeed_date']=jiaoliaoTime_hutaoliao;
        jsonObj['Receive_date']=receive_date_data;
        jsonObj['Vender']=Vender;
        jsonObj['VenderBatch']=VenderBatch;
        android.print(JSON.stringify(jsonObj));
        xgxx.ajax('SheathExec/SaveCallSheathForSheathM?callback=callback',{
            data:{
                savejson:JSON.stringify(jsonObj)
            },
            success: function (result, status) {
                closeLoading();
                if(result.Msg=="保存成功"){
                    android.showToast("收料成功");
//                    window.location.reload();//刷新当前页面
                    $('#confirmDiv_htliao').hide();
                    getTaskList(my_macno,xgxx.server_Domain);
                }
            },
            error: function (error) {
                closeLoading();
                alert("错误"+JSON.stringify(error));
            }
        });
    }
    
    
    
    /**
     * 钢铝带
     * @param time
     * @returns {number}  0203870
     */
    //获取钢铝带类别
    //调SheathExec/GetSheathFeedSteelList接口，获取物料名称和物料规格，根据返回的OK_NEW（显示叫料），OK_EXIST（显示收料）；当点按钮时，弹出对话框，然后完成收料
    function GetSheathFeedSteelList(BATCHNUM,num) {
        showLoading();
        android.startLoading();
        android.print("^^^^^^^^^^^^^"+BATCHNUM);
        xgxx.ajax('SheathExec/GetSheathFeedSteelList?callback=callback',{
            data:{
                batchnum:BATCHNUM,
                flag:"1",
                user:myusername
            },
            success: function (result, status) {
                closeLoading();
                android.endLoading();
                if(result.Code==400){
                    android.showToast(result.Msg);
                    return;
                }
                if(result.Code==200){
                    if(result.Msg=='OK_EXIST'){
                        var btnflag = eval(result.Data);
                        if(btnflag[0].send_date==null){
                            //集中供料未送料，按钮禁用
                            $("#taskshow_lvdai_"+num).find('.order-btn').eq(0).css('background','#cccccc');
                            $("#taskshow_lvdai_"+num).find('.order-btn').eq(0).attr('disabled','disabled');
                            $("#taskshow_lvdai_"+num).find('.order-btn').eq(0).html('收料');
                        }else{
                            //集中供料已送料，按钮变为收料
                            $("#taskshow_lvdai_"+num).find('.order-btn').eq(0).html('收料');
                        }
                    }else{
                        $("#taskshow_lvdai_"+num).find('.order-btn').eq(0).html('叫料');
                    }
                }
                var jsonData = eval(result.Data);
                if(result.Msg=="空"){
                    android.showToast("没有数据");
                }
                if(jsonData==undefined || jsonData.length<1){
                    $("#taskshow_lvdai_"+num).find('.order-btn').eq(0).css('background','#cccccc');
                    $("#taskshow_lvdai_"+num).find('.order-btn').eq(0).attr('disabled','disabled');
                    return;
                }
                $('#taskshow_lvdai_'+num).find('table tbody').find('td').eq(0).html(jsonData[0].ChildCode);
                $('#taskshow_lvdai_'+num).find('table tbody').find('td').eq(1).html(jsonData[0].SPEC);
                $('#taskshow_lvdai_'+num).find('table tbody').find('td').eq(2).html(jsonData[0].FEED_ID);
                $('#taskshow_lvdai_'+num).find('table tbody').find('td').eq(3).html(jsonData[0].ToFeed_date);
                $('#taskshow_lvdai_'+num).find('table tbody').find('td').eq(4).html(jsonData[0].Receive_date);
//                $('#taskshow_lvdai_'+num).find('.gldai_type').eq(0).html("");
//                for(var i=0; i<jsonData.length; i++){
//                    $('#taskshow_lvdai_'+num).find('.gldai_type').eq(0).append("<option value='"+jsonData[i]['cnname']+"'>"+jsonData[i]['cnname']+"</option>");
//                }

                $("#taskshow_lvdai_"+num).find('.order-btn').eq(0).click(function () {
                    if($("#taskshow_lvdai_"+num).find('.order-btn').eq(0).html()=='叫料'){
                        if(num>1){
                            var batchnum = $('#task'+(num-1)).find('td').eq(0).html();//生产批号
                            android.startLoading();
                            xgxx.ajax('SheathExec/SheathCheckLoading?callback=callback',{
                                data:{
                                    batchnum:batchnum,
                                    childcode:'aaa'
                                },
                                success: function (result, status) {
                                    android.endLoading();
                                    android.print(JSON.stringify(result));
                                    if(result.Code==200 && result.Msg=="已上料"){
                                        //只有缆芯的上一条任务上料，护套料和钢铝带的下一任务才能叫料
                                        xgxx.ajax('SheathExec/GetSheathFeedSteelList?callback=callback',{
                                            data:{
                                                batchnum:BATCHNUM,
                                                flag:"2",
                                                user:myusername
                                            },
                                            success: function (result, status) {
                                                closeLoading();
                                                android.print(JSON.stringify(result));
                                                if(result.Code==200){
                                                    android.showToast("叫料成功");
                                                    var jsonData = eval(result.Data);
                                                    $("#taskshow_lvdai_"+publicNum_ganglvdai).find('.order-btn').eq(0).html("收料");
                                                    $('#taskshow_lvdai_'+publicNum_ganglvdai).find('table tbody').find('td').eq(2).html(jsonData[0].FEED_ID);
//                                                    $('#confirmDiv_gldai').show();
//                                                    $('#confirmDiv_gldai').find('.vender_input').eq(0).val("");
//                                                    $('#confirmDiv_gldai').find('.batch_input').eq(0).val("");
                                                }
                                            },
                                            error: function (error) {
                                                closeLoading();
                                                alert("错误"+JSON.stringify(error));
                                            }
                                        });
                                    }else if(result.Code==200 && result.Msg=="未上料"){
                                        $('#alert_p').html("前一计划未完成上料，不允许叫料");
                                        $('#alertDiv').show();
                                    }else{
                                        $('#alert_p').html(result.Msg);
                                        $('#alertDiv').show();
                                    }
                                },
                                error: function (error) {
                                    android.endLoading();
                                }
                            });
                        }else{
                            android.print("batchnum:"+BATCHNUM);
                            android.print("user:"+myusername);
                            xgxx.ajax('SheathExec/GetSheathFeedSteelList?callback=callback',{
                                data:{
                                    batchnum:BATCHNUM,
                                    flag:"2",
                                    user:myusername
                                },
                                success: function (result, status) {
                                    closeLoading();
                                    android.print(JSON.stringify(result));
                                    if(result.Code==200){
                                        android.showToast("叫料成功");
                                        var jsonData = eval(result.Data);
                                        $("#taskshow_lvdai_"+publicNum_ganglvdai).find('.order-btn').eq(0).html("收料");
                                        $('#taskshow_lvdai_'+publicNum_ganglvdai).find('table tbody').find('td').eq(2).html(jsonData[0].FEED_ID);
                                        refreashTastList(my_macno);
//                                        $('#confirmDiv_gldai').show();
//                                        $('#confirmDiv_gldai').find('.vender_input').eq(0).val("");
//                                        $('#confirmDiv_gldai').find('.batch_input').eq(0).val("");
//                                    refreashTastList(my_macno);
                                    }
                                },
                                error: function (error) {
                                    closeLoading();
                                    alert("错误"+JSON.stringify(error));
                                }
                            });
                        }
                    }else{
                        $('#confirmDiv_gldai').show();
                    }
                });
            },
            error: function (error) {
                closeLoading();
                android.endLoading();
                alert("错误"+JSON.stringify(error));
            }
        });
    }

    //确认收料
    function gldai_sureReceive() {

        if(my_macno=="mac000"){
            var Vender = $('#confirmDiv_gldai').find('.vender_input').eq(0).val();
            var VenderBatch = $('#confirmDiv_gldai').find('.batch_input').eq(0).val();
            if(Vender.length<1 || Vender==null || Vender==""){
                android.showToast("请输入厂家名称");
                return;
            }
            if(VenderBatch.length<1 || VenderBatch==null || VenderBatch==""){
                android.showToast("请输入批次号");
                return;
            }
            android.showToast("收料成功");
            $('#confirmDiv_gldai').hide();
            getTaskList(my_macno,xgxx.server_Domain);
            return;
        }

        var date = new Date();
        var receive_date_data=Format(date,"yyyy-MM-dd HH:mm:ss");
        var Vender = $('#confirmDiv_gldai').find('.vender_input').eq(0).val();
        var VenderBatch = $('#confirmDiv_gldai').find('.batch_input').eq(0).val();
        if(Vender.length<1 || Vender==null || Vender==""){
            android.showToast("请输入厂家名称");
            return;
        }
        if(VenderBatch.length<1 || VenderBatch==null || VenderBatch==""){
            android.showToast("请输入批次号");
            return;
        }
        var feed_id = $('#taskshow_lvdai_'+publicNum_ganglvdai).find('table tbody').find('td').eq(2).html();
        var jsonObj={};
        jsonObj['Feed_id']=feed_id;
        jsonObj['ToFeed_date']=$('#taskshow_lvdai_'+publicNum_ganglvdai).find('table tbody').find('td').eq(3).html();
        jsonObj['Receive_date']=receive_date_data;
        jsonObj['Vender']=Vender;
        jsonObj['VenderBatch']=VenderBatch;
        android.print(JSON.stringify(jsonObj));
        android.startLoading();
        xgxx.ajax('SheathExec/SaveCallSheathForSheathM?callback=callback',{
            data:{
                savejson:JSON.stringify(jsonObj)
            },
            success: function (result, status) {
                closeLoading();
                android.endLoading();
                if(result.Msg=="保存成功"){
                    android.showToast("收料成功");
                    $('#confirmDiv_gldai').hide();
                    refreashTastList(my_macno);
                }
            },
            error: function (error) {
                closeLoading();
                android.endLoading();
            }
        });
    }

    function refreashTastList(macno) {
        showLoading();
        document.getElementById('formBody').innerHTML = doT.template(template)("");
        document.getElementById('formBody_hutaoliao').innerHTML = doT.template(template2)("");
        document.getElementById('formBody_ganglvdai').innerHTML = doT.template(template3)("");
        showLoading();
        my_macno=macno;
        android.print(my_macno);
        xgxx.ajax('SheathExec/GetSheathTask?callback=callback',{
            data:{
                maccode:my_macno
            },
            success: function (result, status) {
                closeLoading();
                var jsonData = eval(result.Data);
                //加载缆芯列表
                document.getElementById('formBody').innerHTML = doT.template(template)(jsonData);
                //加载护套料列表
                document.getElementById('formBody_hutaoliao').innerHTML = doT.template(template2)(jsonData);
                //加载钢铝带列表
                document.getElementById('formBody_ganglvdai').innerHTML = doT.template(template3)(jsonData);

                //缆芯列表如果该行为已叫料状态，则为绿色
                for(var k=0; k<jsonData.length; k++){
                    if(jsonData[k].Receive_State=="1" || jsonData[k].Receive_State==1){
                        $('#task'+(k+1)).find('td').css('background','#1d953f');
                    }
                }

                //缆芯
                $('.task').click(function () {
                    var line_id = $(this).attr('id');
                    var num = $(this).find('th').eq(0).html();
                    publicNum = num;
                    if($("#taskshow"+num).is(":hidden")){
                        $('.task-show').hide();
                        var BATCHNUM = $(this).children('td').eq(0)[0].innerHTML;//厂商
                        var CHILDTYPE = $(this).children('td').eq(6)[0].innerHTML;//种类
                        GetSheathTaskFeedList(BATCHNUM,CHILDTYPE,num);//任务表展开 num--行数
                        $("#taskshow"+num).show();
                    }else{
                        $("#taskshow"+num).hide();
                    }
                });
                //护套料
                $('.task2').click(function () {
                    var line_id = $(this).attr('id');
                    var num = $(this).find('th').eq(0).html();
                    publicNum_hutao = num;
                    if($("#taskshow_hutao_"+num).is(":hidden")){
                        $('.task-show').hide();
                        var BATCHNUM = $(this).children('td').eq(0)[0].innerHTML;//厂商
                        var CHILDTYPE = $(this).children('td').eq(6)[0].innerHTML;//种类
                        GetSheathTaskSheathType(BATCHNUM,num);//获取护套料类别
                        $("#taskshow_hutao_"+num).show();
                    }else{
                        $("#taskshow_hutao_"+num).hide();
                    }
                });
                //钢铝带
                $('.task3').click(function () {
                    var line_id = $(this).attr('id');
                    var num = $(this).find('th').eq(0).html();
                    publicNum_ganglvdai = num;
                    if($("#taskshow_lvdai_"+num).is(":hidden")){
                        $('.task-show').hide();
                        var BATCHNUM = $(this).children('td').eq(0)[0].innerHTML;//厂商
                        var CHILDTYPE = $(this).children('td').eq(6)[0].innerHTML;//种类
                        GetSheathFeedSteelList(BATCHNUM,num);//获取钢铝带类别
                        $("#taskshow_lvdai_"+num).show();
                    }else{
                        $("#taskshow_lvdai_"+num).hide();
                    }
                });
            },
            error: function (error) {
                closeLoading();
                alert("错误"+JSON.stringify(error));
            }
        });
    }

    //计算等待分钟数
    function getWaitMinuts(time) {
        var date = new Date(time);
        var date_now=new Date();
        var date_cha=date_now.getTime()-date.getTime();
        return Math.floor((date_cha/60000))
    }
    //开启计时器
    function TimerStart(num) {
        var second=1;
        var myminutes = 0;
        Timer = setInterval(function () {
            if(second<10){
                $("#taskshow"+num).find('.waittingTime').eq(0).html(myminutes+"分:0"+second+"秒");
                second++;
            }else if(second>59){
                myminutes = myminutes+1;
                second=0;
                $("#taskshow"+num).find('.waittingTime').eq(0).html(myminutes+"分:0"+second+"秒");

            }else if(second>10 || second<=59){
                $("#taskshow"+num).find('.waittingTime').eq(0).html(myminutes+"分:"+second+"秒");
                second++;
            }
        },1000);
    }
    //取消收料----缆芯
    function cancleReceive() {
        hideOverlay();//显示遮罩框
//        clearInterval(Timer);
//        jiaoliaoTime="";
//        $("#taskshow"+publicNum).find('.waittingTime').eq(0).html("");
        $('#confirmDiv').hide();
        refreashTastList(my_macno);
    }
    //取消收料----护料套
    function htliao_cancleReceive() {
        hideOverlay();//显示遮罩框
        jiaoliaoTime_hutaoliao="";
        $('#confirmDiv_htliao').hide();
        refreashTastList(my_macno);
    }
    //取消收料----钢铝带
    function gldai_cancleReceive() {
        $('#confirmDiv_gldai').hide();
        if(my_macno=="mac000"){
//            getTaskList(my_macno);
        }else{
            refreashTastList(my_macno);
        }
    }

    /**
     * 统计分析
     *
     */
    function initEcharts() {
        //设置容器的宽高
        $('#productDiv').css("width",$('#productDiv').parent().width()*0.96);
        $('#productDiv').css("height",$('#productDiv').width()+140+'px');
        $('#qulityDiv').css("width",$('#qulityDiv').parent().width()*0.96);
        $('#qulityDiv').css("height",$('#qulityDiv').width()+140+'px');
        //获取当前时间
        var date = new Date();
        var formatDate=Format(date,"yyyy-MM-dd HH:mm");
        // 基于准备好的dom，初始化echarts实例
        var productChart = echarts.init(document.getElementById('productDiv'));
        var qulityChart = echarts.init(document.getElementById('qulityDiv'));
        showLoading();
        if(my_macno=="mac000"){
            var normal_finish=12;//1正常完成
            var delay_finish=48;//2延期完成
            var unfinish=25;//3未完成
            var delay_unfinish=15;//4延期未完成

            var total_length=(normal_finish+delay_finish+unfinish+delay_unfinish).toFixed(2);//总长度
            var ok_length=80;
            option = {
                title: {
                    text: '生产总长度',
                    subtext: total_length+'km',
                    x: 'center',
                    y: 'center',
                    textStyle: {
                        fontWeight: 'normal',
                        fontSize: 16
                    },
                    subtextStyle:{
                        color:'#019BF8',
                        fontWeight:'bold',
                        fontSize: 20
                    }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{b}: {c} ({d}%)"
                },
                legend: {
                    orient: 'vertical',
                    bottom:"0",
                    data:['准时完成','延期完成','未完成','延期未完成'],
                    selectedMode:false
                },
                color: ['#00B050','#3C7BC8','#C00000','#FFC000'],
                series: [
                    {
                        name:'访问来源',
                        type:'pie',
                        radius: ['45%', '70%'],
                        avoidLabelOverlap: false,
                        label: {
                            normal: {
                                show: true,
                                position: 'inside',
                                formatter:'{d} %'
                            }
                        },
                        labelLine: {
                            normal: {
                                show: true
                            }
                        },
                        data:[
                            {value:normal_finish, name:'准时完成',itemStyle:{
                                normal:{
                                    label:{
                                        show: function(){
                                            if(normal_finish == 0){
                                                return false;
                                            }else{
                                                return true;
                                            }
                                        }(),
                                        position: 'outside',
                                        formatter: '{d}%',
                                        textStyle:{
                                            color:'#888888',
                                            fontSize:'15'
                                        }
                                    },
                                    labelLine :{
                                        show:function(){
                                            if(normal_finish == 0){
                                                return false;
                                            }else{
                                                return true;
                                            }
                                        }(),
                                        length:2,
                                        smooth:0
                                    }
                                }
                            }},
                            {value:delay_finish, name:'延期完成',itemStyle:{
                                normal:{
                                    label:{
                                        show: function(){
                                            if(delay_finish == 0){
                                                return false;
                                            }else{
                                                return true;
                                            }
                                        }(),
                                        position: 'outside',
                                        formatter: '{d}%',
                                        textStyle:{
                                            color:'#888888',
                                            fontSize:'15'
                                        }
                                    },
                                    labelLine :{
                                        show:function(){
                                            if(delay_finish == 0){
                                                return false;
                                            }else{
                                                return true;
                                            }
                                        }(),
                                        length:2,
                                        smooth:0
                                    }
                                }
                            }},
                            {value:unfinish, name:'未完成',itemStyle:{
                                normal:{
                                    label:{
                                        show: function(){
                                            if(unfinish == 0){
                                                return false;
                                            }else{
                                                return true;
                                            }
                                        }(),
                                        position: 'outside',
                                        formatter: '{d}%',
                                        textStyle:{
                                            color:'#888888',
                                            fontSize:'15'
                                        }
                                    },
                                    labelLine :{
                                        show:function(){
                                            if(unfinish == 0){
                                                return false;
                                            }else{
                                                return true;
                                            }
                                        }(),
                                        length:2,
                                        smooth:0
                                    }
                                }
                            }},
                            {value:delay_unfinish, name:'延期未完成',itemStyle:{
                                normal:{
                                    label:{
                                        show: function(){
                                            if(delay_unfinish == 0){
                                                return false;
                                            }else{
                                                return true;
                                            }
                                        }(),
                                        position: 'outside',
                                        formatter: '{d}%',
                                        textStyle:{
                                            color:'#888888',
                                            fontSize:'15'
                                        }
                                    },
                                    labelLine :{
                                        show:function(){
                                            if(delay_unfinish == 0){
                                                return false;
                                            }else{
                                                return true;
                                            }
                                        }(),
                                        length:2,
                                        smooth:0
                                    }
                                }
                            }}
                        ]
                    }
                ],
                color: ['#00B050','#3C7BC8','#FFC000','#C00000']
            };
            // 使用刚指定的配置项和数据显示图表。
            productChart.setOption(option);

            option = {
                title: {
                    text: '合格总长度',
                    subtext: ok_length+'km',
                    x: 'center',
                    y: 'center',
                    textStyle: {
                        fontWeight: 'normal',
                        fontSize: 16
                    },
                    subtextStyle:{
                        color:'#019BF8',
                        fontWeight:'bold',
                        fontSize: 20
                    }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{b}: {c} ({d}%)"
                },
                legend: {
                    orient: 'vertical',
                    bottom:"40",
                    data:['合格','不合格'],
                    selectedMode:false
                },
                series: [
                    {
                        name:'',
                        type:'pie',
                        radius: ['45%', '70%'],
                        avoidLabelOverlap: false,
                        data:[
                            {value:ok_length, name:'合格',itemStyle:{
                                normal:{
                                    label:{
                                        show: function(){
                                            if(ok_length == 0){
                                                return false;
                                            }else{
                                                return true;
                                            }
                                        }(),
                                        position: 'outside',
                                        formatter: '{d}%',
                                        textStyle:{
                                            color:'#888888',
                                            fontSize:'15'
                                        }
                                    },
                                    labelLine :{
                                        show:function(){
                                            if(ok_length == 0){
                                                return false;
                                            }else{
                                                return true;
                                            }
                                        }(),
                                        length:2,
                                        smooth:0.2
                                    }
                                }
                            }},
                            {value:total_length-ok_length, name:'不合格',itemStyle:{
                                normal:{
                                    label:{
                                        show: function(){
                                            disok_length=total_length-ok_length;
                                            if(disok_length == 0) return false;
                                        }(),
                                        position: 'outside',
                                        formatter: '{d}%',
                                        textStyle:{
                                            color:'#888888',
                                            fontSize:'15'
                                        }
                                    },
                                    labelLine :{
                                        show:function(){
                                            disok_length=total_length-ok_length;
                                            if(disok_length == 0){
                                                return false;
                                            }else{
                                                return true;
                                            }
                                        }(),
                                        length:2,//设置指示线长度
                                        smooth:0.2//设置指示线平滑度
                                    }
                                }
                            }}
                        ]
                    }
                ],
                color: ['#3C7BC8','#C00000']
            };
            // 使用刚指定的配置项和数据显示图表。
            qulityChart.setOption(option);
            getDaiJianList();//获取待检列表
            return;
        }else{
            android.print(my_macno);
            android.print(formatDate);
            xgxx.ajax('SheathExec/GetSheathPQAnalysis?callback=callback',{
                data:{
                    dtime:formatDate,
                    maccode:my_macno
                },
                success: function (result, status) {
                    closeLoading();
                    var jsonData = eval(result.Data);
//                    android.showToast(JSON.stringify(result));
                    //把null替换成0
                    for(var j=0; j<jsonData.length; j++){
                        var obj = jsonData[j];
                        for(var i in obj) {
                            if(Object.prototype.hasOwnProperty.call(obj,i)) { //过滤
                                if(obj[i]==null){
                                    obj[i]=0;
                                }
                            }
                        }
                    }
                    android.print('jsonData:'+JSON.stringify(jsonData));

                    var normal_finish=parseFloat(jsonData[0].macname);//1正常完成
                    var delay_finish=parseFloat(jsonData[1].macname);//2延期完成
                    var unfinish=parseFloat(jsonData[2].macname);//3未完成
                    var delay_unfinish=parseFloat(jsonData[3].macname);//4延期未完成

                    var total_length=parseFloat(jsonData[4].macname);//总长度
                    var ok_length=parseFloat(jsonData[5].macname);//合格长度
                    var no_ok_length=parseFloat(jsonData[6].macname);//不合格长度

//                    var total_length=(normal_finish+delay_finish+unfinish+delay_unfinish).toFixed(2);//总长度
//                    var ok_length=total_length*parseFloat(jsonData[5].macname);


//                    if(total_length==0){
//                        //质量状况的饼图跟之前三个工序无数据时的显示相同
//
//
//                    }

                    android.print('normal_finish:'+normal_finish);
                    android.print('delay_finish:'+delay_finish);
                    android.print('unfinish:'+unfinish);
                    android.print('delay_unfinish:'+delay_unfinish);
                    android.print('total_length:'+total_length);
                    android.print('ok_length:'+ok_length);
                    android.print('no_ok_length:'+no_ok_length);

                    option = {
                        title: {
                            text: '生产总长度',
                            subtext: total_length+'km',
                            x: 'center',
                            y: 'center',
                            textStyle: {
                                fontWeight: 'normal',
                                fontSize: 16
                            },
                            subtextStyle:{
                                color:'#019BF8',
                                fontWeight:'bold',
                                fontSize: 20
                            }
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: "{b}: {c} ({d}%)"
                        },
                        legend: {
                            orient: 'vertical',
                            bottom:"0",
                            data:['准时完成','延期完成','未完成','延期未完成'],
                            selectedMode:false
                        },
                        color: ['#00B050','#3C7BC8','#C00000','#FFC000'],
                        series: [
                            {
                                name:'访问来源',
                                type:'pie',
                                radius: ['45%', '70%'],
                                avoidLabelOverlap: false,
                                label: {
                                    normal: {
                                        show: true,
                                        position: 'inside',
                                        formatter:'{d} %'
                                    }
                                },
                                labelLine: {
                                    normal: {
                                        show: true
                                    }
                                },
                                data:[
                                    {value:normal_finish, name:'准时完成',itemStyle:{
                                        normal:{
                                            label:{
                                                show: function(){
                                                    if(normal_finish == 0){
                                                        return false;
                                                    }else{
                                                        return true;
                                                    }
                                                }(),
                                                position: 'outside',
                                                formatter: '{d}%',
                                                textStyle:{
                                                    color:'#888888',
                                                    fontSize:'15'
                                                }
                                            },
                                            labelLine :{
                                                show:function(){
                                                    if(normal_finish == 0){
                                                        return false;
                                                    }else{
                                                        return true;
                                                    }
                                                }(),
                                                length:2,
                                                smooth:0
                                            }
                                        }
                                    }},
                                    {value:delay_finish, name:'延期完成',itemStyle:{
                                        normal:{
                                            label:{
                                                show: function(){
                                                    if(delay_finish == 0){
                                                        return false;
                                                    }else{
                                                        return true;
                                                    }
                                                }(),
                                                position: 'outside',
                                                formatter: '{d}%',
                                                textStyle:{
                                                    color:'#888888',
                                                    fontSize:'15'
                                                }
                                            },
                                            labelLine :{
                                                show:function(){
                                                    if(delay_finish == 0){
                                                        return false;
                                                    }else{
                                                        return true;
                                                    }
                                                }(),
                                                length:2,
                                                smooth:0
                                            }
                                        }
                                    }},
                                    {value:unfinish, name:'未完成',itemStyle:{
                                        normal:{
                                            label:{
                                                show: function(){
                                                    if(unfinish == 0){
                                                        return false;
                                                    }else{
                                                        return true;
                                                    }
                                                }(),
                                                position: 'outside',
                                                formatter: '{d}%',
                                                textStyle:{
                                                    color:'#888888',
                                                    fontSize:'15'
                                                }
                                            },
                                            labelLine :{
                                                show:function(){
                                                    if(unfinish == 0){
                                                        return false;
                                                    }else{
                                                        return true;
                                                    }
                                                }(),
                                                length:2,
                                                smooth:0
                                            }
                                        }
                                    }},
                                    {value:delay_unfinish, name:'延期未完成',itemStyle:{
                                        normal:{
                                            label:{
                                                show: function(){
                                                    if(delay_unfinish == 0){
                                                        return false;
                                                    }else{
                                                        return true;
                                                    }
                                                }(),
                                                position: 'outside',
                                                formatter: '{d}%',
                                                textStyle:{
                                                    color:'#888888',
                                                    fontSize:'15'
                                                }
                                            },
                                            labelLine :{
                                                show:function(){
                                                    if(delay_unfinish == 0){
                                                        return false;
                                                    }else{
                                                        return true;
                                                    }
                                                }(),
                                                length:2,
                                                smooth:0
                                            }
                                        }
                                    }}
                                ]
                            }
                        ],
                        color: ['#00B050','#3C7BC8','#FFC000','#C00000']
                    };
                    // 使用刚指定的配置项和数据显示图表。
                    productChart.setOption(option);

                    option = {
                        title: {
                            text: '合格总长度',
                            subtext: ok_length+'km',
                            x: 'center',
                            y: 'center',
                            textStyle: {
                                fontWeight: 'normal',
                                fontSize: 16
                            },
                            subtextStyle:{
                                color:'#019BF8',
                                fontWeight:'bold',
                                fontSize: 20
                            }
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: "{b}: {c} ({d}%)"
                        },
                        legend: {
                            orient: 'vertical',
                            bottom:"40",
                            data:['合格','不合格'],
                            selectedMode:false
                        },
                        series: [
                            {
                                name:'',
                                type:'pie',
                                radius: ['45%', '70%'],
                                avoidLabelOverlap: false,
                                data:[
                                    {value:ok_length, name:'合格',itemStyle:{
                                        normal:{
                                            label:{
                                                show: function(){
                                                    if(ok_length == 0){
                                                        return false;
                                                    }else{
                                                        return true;
                                                    }
                                                }(),
                                                position: 'outside',
                                                formatter: '{d}%',
                                                textStyle:{
                                                    color:'#888888',
                                                    fontSize:'15'
                                                }
                                            },
                                            labelLine :{
                                                show:function(){
                                                    if(ok_length == 0){
                                                        return false;
                                                    }else{
                                                        return true;
                                                    }
                                                }(),
                                                length:2,
                                                smooth:0.2
                                            }
                                        }
                                    }},
                                    {value:no_ok_length, name:'不合格',itemStyle:{
                                        normal:{
                                            label:{
                                                show: function(){
                                                    disok_length=no_ok_length;
                                                    if(disok_length == 0) return false;
                                                }(),
                                                position: 'outside',
                                                formatter: '{d}%',
                                                textStyle:{
                                                    color:'#888888',
                                                    fontSize:'15'
                                                }
                                            },
                                            labelLine :{
                                                show:function(){
                                                    disok_length=no_ok_length;
                                                    if(disok_length == 0){
                                                        return false;
                                                    }else{
                                                        return true;
                                                    }
                                                }(),
                                                length:2,//设置指示线长度
                                                smooth:0.2//设置指示线平滑度
                                            }
                                        }
                                    }}
                                ]
                            }
                        ],
                        color: ['#3C7BC8','#C00000']
                    };
                    // 使用刚指定的配置项和数据显示图表。
                    qulityChart.setOption(option);
                    getDaiJianList();//获取待检列表
                },
                error: function (error) {
                    closeLoading();
                    alert("错误"+JSON.stringify(error));
                }
            });
        }
    }

    //饼状图点击事件
    function openShowActivity(flag) {
        android.openShowActivity(flag,my_macno);
    }

    /**
     * 待检
     *
     */
    function getDaiJianList() {
        if(my_macno=="mac000"){
            android.endLoading();
            var jsonData = eval('[{"编号":"170600833","规格":"GYTS-12φ1.84*5(6*2)-Q-v7YD","盘长":3005,"作业人员":"张宗国","下机时间":"2017-05-18T16:46:30.12","状态":"待检测"},{"编号":"170600837","规格":"GYTS-12φ1.84*5(6*2)-Q-v7YD","盘长":4005,"作业人员":"刘龙","下机时间":"2017-05-21T15:51:50.523","状态":"待检测"},{"编号":"170601185","规格":"GYTS-24φ1.84*5(6*4)-Q-v4DX","盘长":4005,"作业人员":"刘龙飞","下机时间":"2017-05-23T10:18:22.433","状态":"待检测"},{"编号":"170600799","规格":"GYTS-12φ1.84*5(6*2)-Q-v7YD","盘长":3005,"作业人员":"陈端瞬","下机时间":"2017-05-25T15:06:32.913","状态":"待检测"},{"编号":"170403148","规格":"GYTA-24φ1.84*5(6*4)-Q-v7YD","盘长":4005,"作业人员":"刘龙","下机时间":"2017-05-25T19:21:42.34","状态":"待检测"},{"编号":"170600925","规格":"GYTS-24φ1.84*5(6*4)-Q-v7YD","盘长":4005,"作业人员":"刘龙","下机时间":"2017-05-26T15:46:35.79","状态":"待检测"},{"编号":"17052821-301","规格":"GYTA-48φ2.54*5(12*4)-Q-v5一护","盘长":6044,"作业人员":"王小平","下机时间":"2017-05-26T19:37:06.733","状态":"待检测"},{"编号":"17050906-301-1","规格":"GYTA-24φ1.84*6(6*4)-Q-v5一护","盘长":12040,"作业人员":"马泽平","下机时间":"2017-05-26T19:42:56.87","状态":"待检测"}]');
            for(var i=0; i<jsonData.length; i++){
                var tempStr=jsonData[i].下机时间.replace('T', ' ');
                jsonData[i].下机时间=tempStr.substring(0,16);
            }
            document.getElementById('formBody_daijian').innerHTML = doT.template(template_daijian)(jsonData);
            return;
        }else{
            var date = new Date();
            var formatDate=Format(date,"yyyy-MM-dd HH:mm");
            android.print("======="+formatDate);
            android.print("======="+my_macno);
            xgxx.ajax('SheathExec/GetSheathWaitingCheck?callback=callback',{
                data:{
                    dtime:formatDate,
                    maccode:my_macno
                },
                success: function (result, status) {
                    android.endLoading();
                    closeLoading();
                    var jsonData = eval(result.Data);
                    for(var i=0; i<jsonData.length; i++){
                        var tempStr=jsonData[i].下机时间.replace('T', ' ');
                        jsonData[i].下机时间=tempStr.substring(0,16);
                    }
                    document.getElementById('formBody_daijian').innerHTML = doT.template(template_daijian)(jsonData);
                },
                error: function (error) {
                    android.endLoading();
                    closeLoading();
                    alert("错误"+JSON.stringify(error));
                }
            });
        }
    }
</script>
</body>
</html>



